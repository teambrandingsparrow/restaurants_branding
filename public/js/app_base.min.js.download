
app.p_views={};app.p_view_inst={};app.models={};app.errors=[];app.popup_views={};app.popups={};function escapeRegExp(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function replaceAll(c,b,a){return c.replace(new RegExp(escapeRegExp(b),"g"),a)}function getCookie(d){var b=d+"=";var f=decodeURIComponent(document.cookie);var a=f.split(";");for(var e=0;e<a.length;e++){var g=a[e];while(g.charAt(0)==" "){g=g.substring(1)}if(g.indexOf(b)==0){return g.substring(b.length,g.length)}}return""}function objFilter(f,d){var a,c,e,b;e=Object.keys(f);a={};for(b=0;b<e.length;b++){c=e[b];if(d(f[c])){a[c]=f[c]}}return a}window.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];Backbone.sync=function(a,f,k){var b={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};var h=b[a];if(!k.noCSRF){var i=k.beforeSend;if(a!="read"||k.attach_csrf){k.beforeSend=function(m){var l=getCookie("csrftoken");if(l){m.setRequestHeader("X-CSRFToken",l)}if(i){return i.apply(this,arguments)}}}}if(true){var e=_.result(f,"url").split("?"),c=e[0],d=e[1];c+=c.charAt(c.length-1)=="/"?"":"/";if(!_.isUndefined(d)){c+="?"+d}k=_.extend(k,{url:c})}_.defaults(k||(k={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var d={type:h,dataType:"json"};if(!k.url){d.url=_.result(f,"url")||urlError()}if(k.data==null&&f&&(a==="create"||a==="update"||a==="patch")){d.contentType="application/json";d.data=JSON.stringify(k.attrs||f.toJSON(k))}if(k.emulateJSON){d.contentType="application/x-www-form-urlencoded";d.data=d.data?{model:d.data}:{}}if(k.emulateHTTP&&(h==="PUT"||h==="DELETE"||h==="PATCH")){d.type="POST";if(k.emulateJSON){d.data._method=h}var i=k.beforeSend;k.beforeSend=function(l){l.setRequestHeader("X-HTTP-Method-Override",h);if(i){return i.apply(this,arguments)}}}if(d.type!=="GET"&&!k.emulateJSON){d.processData=false}var g=k.error;k.error=function(m,n,l){k.textStatus=n;if(m.status==401){alert("You have been logged out!");document.location.href="/";return}k.errorThrown=l;if(g){g.call(k.context,m,n,l)}};var j=k.xhr=Backbone.ajax(_.extend(d,k));f.trigger("request",f,j,k);return j};Backbone.View.prototype._setElement=function(a){this.$el=a instanceof Backbone.$?a:Backbone.$(a);this.$el.data("backbone_view",this);this.el=this.$el[0]};function is_charkey(a){if(typeof a.which=="undefined"){return true}else{if(typeof a.which=="number"&&a.which>0){return !_.contains([13,16,40,37,39,27,38,9],a.which)}}return false}_.proto=function(d,e,c){var a,b;e=e||0;b=d;for(a=0;a<=e;a++){b=c?(b.prototype):(Object.getPrototypeOf?Object.getPrototypeOf(b):b.__proto__)}return b};_.sum=function(e,c){var d=0,b,a;a=(e&&typeof(e[0])=="object");for(b=0;b<e.length;b++){d+=(a?e[b][c]:e[b])}return d};_.in_list=function(c,d,a,b){return _.contains(d,c,a,b)};Backbone.View.merge=function(c,b){var e,a,d;e=function(g,f){for(var h in f){if(Object.prototype.hasOwnProperty.call(f,h)&&(b?!Object.prototype.hasOwnProperty.call(g,h):true)){g[h]=f[h]}}return g};a=this;if(!_.isArray(c)){c=[c]}_.each(c,function(f){if(_.isFunction(f)){d=f.prototype}else{d=f}e(a.prototype,d)});return a};app._objs={};window.set_objs=function(a){_.extend(app._objs,a)};window.get_obj=function(a){return app._objs[a]};function traverse(e,c){var c,d,a,f,b;f=e;d=c.split(".");for(b=0,a=d.length;b<a;b++){if(f){f=f[d[b]]}else{break}}return f}app.sync_date=function(){var a=new Date(app.date_time.django_dt);var b=new Date(app.date_time.js_dt);var c=Math.abs(a.getTime()-b.getTime());if(c>600000){return c}else{return 0}};window.parse_date=Date.fromString=function(f,j){var i,e,h,g,a,b,c;b=(new Date()).getFullYear();if(!j||j=="DMY"){i=/^([0-9]{1,2})[-\/\.]([0-9]{1,2})([-\/\.]([0-9]{2,4}))?$/g;e=i.exec(f);if(!e){return null}h=Number(e[1]);g=Number(e[2]);a=Number(e[4])}else{i=/^(([0-9]{2,4})[-\/])?([0-9]{1,2})[-\/]([0-9]{1,2})$/g;e=i.exec(f);if(!e){return null}h=Number(e[4]);g=Number(e[3]);a=Number(e[2])}if(a){if(a<100){a+=a<=b?2000:1900}else{if(a<1900){return null}}}else{a=b}c=new Date(a,g-1,h);if(c.getDate()!=h||c.getMonth()!=g-1||c.getFullYear()!=a){return null}return c};Date.diffInDays=function(c,b){var a;a=24*60*60*1000;return Math.round(Math.abs((c.getTime()-b.getTime())/(a)))};function pad(a,b){return("000000000"+a).substr(-b)}Date.prototype.toString=function(a){if(!a||a=="DMY"){return this.getDate()+"/"+(this.getMonth()+1)+"/"+this.getFullYear()}else{if(a=="d-m-Y"){return this.getDate()+"-"+(this.getMonth()+1)+"-"+this.getFullYear()}else{if(a=="m"){return this.getMonth()+1}else{return this.getFullYear()+"-"+pad(this.getMonth()+1,2)+"-"+pad(this.getDate(),2)}}}};function pickHex(d,b,f){var c=f;var a=1-c;var e=[Math.round(d[0]*c+b[0]*a),Math.round(d[1]*c+b[1]*a),Math.round(d[2]*c+b[2]*a)];return e}Date.prototype.toDateTimeStr=function(a){var f,b,d,h,c,e,g,i;i=this;d=i.getFullYear();b=i.getMonth()+1;f=i.getDate();h=i.getHours();minutes=i.getMinutes();e=h>=12?"pm":"am";h=h%12;h=h?h:12;minutes=minutes<10?"0"+minutes:minutes;g=f+"-"+b+"-"+d+" "+h+":"+minutes+" "+e;return g};function get_errors(a){return traverse(a,"responseJSON.errors")}function uuidv4(){return([10000000]+-1000+-4000+-8000+-100000000000).replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)})}function get_today_date(){return(new Date()).toString()}app.get_new_voucher_date=function(){return(new Date()).toString()};Date.prototype.addDays=function(b){var a=new Date(this.valueOf());a.setDate(a.getDate()+b);return a};Date.prototype.addMonthDays=function(a,c){var b=new Date(this.valueOf());b.setMonth(b.getMonth()+a);b.setDate(b.getDate()+c);return b};function int64(a){return Number(a)}function getScrollParent(d,b){var f=getComputedStyle(d);var a=f.position==="absolute";var c=b?/(auto|scroll|hidden)/:/(auto|scroll)/;if(f.position==="fixed"){return document.body}for(var e=d;(e=e.parentElement);){f=getComputedStyle(e);if(a&&f.position==="static"){continue}if(c.test(f.overflow+f.overflowY+f.overflowX)){return e}}return document.body}Number.prototype.countDecimals=function(){if(Math.floor(this.valueOf())===this.valueOf()){return 0}return this.toString().split(".").length>1?this.toString().split(".")[1].length||0:0};function to_money(a,e,f,g){var d,c,g,b;a=Number(a);f=f!=undefined?f:2;b=a.countDecimals();g=g!=undefined?g:(b<2?2:(b>f?f:b));d=a.toFixed(g).toString().replace(/\B(?=(?=\d*\.)(\d{3})+(?!\d))/g,",");c=typeof(e)=="string"?e:"_amount";if(e){return'<span class="'+c+(d==0?" _zero":"")+'">'+d+"</span>"}else{return d}}function to_money2(a,e,f,g){var d,c,g,b;a=Number(a);b=a.countDecimals();g=g!=undefined?g:(b<2?2:(b>f?f:b));d=Math.abs(a).toFixed(g).toString().replace(/\B(?=(?=\d*\.)(\d{3})+(?!\d))/g,",");c=typeof(e)=="string"?e:"_amount";if(a<0){d="("+d+")"}if(e){return'<span class="'+c+(d==0?" _zero":"")+'">'+d+"</span>"}else{return d}}Number.prototype.formatMoney=function(k,g,e){var h=this,k=isNaN(k=Math.abs(k))?2:k,g=g==undefined?".":g,e=e==undefined?",":e,f=h<0?"-":"",b=String(parseInt(h=Math.abs(Number(h)||0).toFixed(k))),a=(a=b.length)>3?a%3:0;return f+(a?b.substr(0,a)+e:"")+b.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+e)+(k?g+Math.abs(h-b).toFixed(k).slice(2):"")};FB_Module={modules:[],init_fns:[],register:function(a,b){this.modules.push({options:a,callback:b})},clear:function(){this.modules=[];this.init_fns=[]},load_all:function(){var a;this.modules.sort(function(e,d){var f,c;f=e.options&&e.options.index?e.options.index:0;c=d.options&&d.options.index?d.options.index:0;if(f<c){return -1}if(f>c){return 1}return 0});for(a in this.modules){this.modules[a]["callback"]()}},init_fn:function(a){this.init_fns.push(a)},init_all:function(){var a;for(a in this.init_fns){this.init_fns[a]()}}};function get_doctype(b,a){var c,e,d;d=app.fb_doc_types;for(c in d){if(d[c].abbr==b||c==a){return d[c]}}return{is_enabled:false,en_approval:false}}function has_ch(b,a){return b.indexOf(a)!=-1}function any_nonzero(a){var b;for(b=0;b<a.length;b++){if(a[b]!=0){return true}}return false}function init_sch(){$.ajax({type:"GET",url:"/static/js/dist/app_schema.min.js",async:false,success:function(response){eval(response)},error:function(){}})}function get_cfg(a){return app.appdata[a]}function set_cfg(a,b){app.appdata[a]=b}window.AL={ext_access_map:(function(){var c={},b="0123456789abcdefghijklmnopqrstuvwxyz",a;for(a=0;a<b.length;a++){c[b[a]]=a}return c})(),init:function(){var a=this;a.schema={};$.ajax({type:"GET",url:"/access_lists/schema",async:false,success:function(b){var d=b.schema,c,e=0;for(c in d){d[c]["offset"]=e;d[c]["index"]=Number(c);e+=Object.keys(d[c]["options"]).length;a.schema[d[c]["key"]]=d[c]}},error:function(){}})},check_ext_access:function(g,f,e){var d,c,b,h,a;if(!g||!(g in this.schema)){console.error("Invalid Access item is provided",g);return}d=this.schema[g];a=app.appdata.eh[d.access_keys.indexOf(f)+d.offset];a=this.ext_access_map[a];switch(e){case"allow_grp_rstr":return a&1;case"deny_grp_rstr":return a&2;case"allowdeny_grp_rstr":return a&3}},check_access:function(f,e,d){var c,b,a,g;if(!e||!(e in this.schema)){console.error("Invalid Access item is provided",e);return false}c=this.schema[e];if(d){if(c.access_keys.indexOf(d)==-1){app.errors.push(["Invalid Access key is provided",d]);return}if(d=="fullaccess"){a=true;for(b=0;b<=c.access_keys.length;b++){if(f[b+c.offset]!="*"){a=false}}return a}else{return f[c.access_keys.indexOf(d)+c.offset]=="*"}}else{for(b=c.offset;b<=c.offset+c.access_keys.length-1;b++){if(f[b]!="-"){return true}}return false}},any_access:function(){var d,c,a,b;hash=app.appdata.ah;if(!(arguments[0].constructor===Array)){b=arguments}else{b=arguments[0]}for(d in b){a=b[d].split(".");if(this.check_access(hash,a[0],a[1])){return true}}return false},has_access:function(b,a){var c;c=app.appdata.ah;return this.check_access(c,b,a)},append_to_hash:function(f,e,g){var d=this.options.key||"key";var a=["-","-","-","-","-","-"],c,b;for(c=0;c<f.length;c++){if(f[c][d]==e){switch(f[c]["access"]){case"list":a[0]="*";break;case"create":a[1]="*";break;case"create_alter":a[1]=a[2]="*";break;case"display":a[3]="*";break;case"print":a[4]="*";break;case"fullaccess":for(b in a){a[b]="*"}break}}}return g+a.join("")},encode:function(b,a,e){this.options=e||{};var f,d="",c="";for(f in this.list_items){d=this.append_to_hash(b,f,d);c=this.append_to_hash(a,f,c)}return{allow_hash:d,deny_hash:c}}};window.AL.init();window.browser;if((!!window.opr&&!!opr.addons)||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0){window.browser="opera"}if(typeof InstallTrigger!=="undefined"){window.browser="firefox"}if(/constructor/i.test(window.HTMLElement)||(function(a){return a.toString()==="[object SafariRemoteNotification]"})(!window.safari||(typeof safari!=="undefined"&&window.safari.pushNotification))){window.browser="safari"}if(
/*@cc_on!@*/
false||!!document.documentMode){window.browser="ie"}if(!(
/*@cc_on!@*/
false||!!document.documentMode)&&!!window.StyleMedia){window.browser="edge"}if(!!window.chrome&&(!!window.chrome.webstore||!!window.chrome.runtime)){window.browser="chrome"}if(!!window.chrome&&(!!window.chrome.webstore||!!window.chrome.runtime)&&(navigator.userAgent.indexOf("Edg")!=-1)){window.browser="chromium"};app.models={};app.objects={};window.get_object=function(c,a){var b;if(app.objects[c]){if(a==undefined){b={};_.each(_.sortBy(_.map(app.objects[c],function(e,d){return[d,e]}),function(d){return d[1].index}),function(d){b[d[0]]=d[1].v});return b}else{if(app.objects[c][a]){return app.objects[c][a].v}}}return undefined};function objefy(a){return _.map(a.items,function(b){return _.object(a.cols,b)})}window.set_object=function(c,b,d,a){if(!app.objects[c]){app.objects[c]={}}app.objects[c][b]={v:d,index:a}};app.get_today_date=function(){var a=new Date();return a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear()};app.get_old_date=function(){return"01-01-1900"};app.get_finperiod_start=function(){return app.appdata.finperiod_start};app.generate_url=function(b,e,c,a){var g,f,d;g=(a?window.location.origin+"/#":"")+"/view/";f="";if(c){for(arg in c){d=(f==="")?"?":"&";f+=d+arg+"="+encodeURIComponent(c[arg])}}return g+b+(e?"/"+encodeURIComponent(e):"")+f};app.generate_ext_url=function(a,d,b){var f,e,c;e="";if(b){for(arg in b){c=(e==="")?"?":"&";e+=c+arg+"="+encodeURIComponent(b[arg])}}return a+(d?(a.charAt(a.length-1)!="/"?"/":"")+encodeURIComponent(d):"")+e};app.set_last_no=function(a){var b;if(a.doc_no_stripped){b=app.last_doc_nos[a.dnc_id];if(!b){b=app.last_doc_nos[a.dnc_id]={}}b[a.doc_format]=String(a.doc_no_stripped)}};app.tt_timer=null;app.show_tooltip=function(c,b,a){clearTimeout(app.tt_timer);$("#ds_tooltip").text(c).css({top:b,left:a}).show();app.tt_timer=setTimeout(function(){if($("#ds_tooltip").text()==c){$("#ds_tooltip").hide()}},2000)},app.hide_tooltip=function(){$("#ds_tooltip").hide()},app.set_docno_field=function(b,a){a.components.doc_no[app.fb_doc_types[b].num_method=="auto"?"disable":"enable"]()};app.validate_vchr_date=function(a){var b;if(a==""){return"This field is required"}b=Date.fromString(a);if(!b){return"Invalid Date"}if(b>Date.fromString(app.appdata.finperiod_end)){return"Date cannot be after transaction period"}if(b<Date.fromString(app.appdata.finperiod_start)){return"Date cannot be before transaction period"}return null};app.generate_doc_no=function(o,d,e,g,l,c){var h,p,q,f,n,b,a,j;if(!d){d=new Date();d.setHours(0,0,0,0)}else{d=Date.fromString(d)}if(!d||!app.fb_doc_types[o]||d>Date.fromString(app.appdata.finperiod_end)||d<Date.fromString(app.appdata.finperiod_start)){return""}if(app.fb_doc_types[o].num_method!="auto"){return""}var k=function(r,z){var x,u,w,y,v,t;x=/\{([%#])([\w\-\,]+)\}/g;u=0;w=r;do{m=x.exec(w);if(m){if(z||m[1]=="%"){if(m[2]=="Y"){r=r.replace(m[0],d.getFullYear())}else{if(m[2]=="y"){r=r.replace(m[0],String(d.getFullYear()).slice(-2).padStart(2,0))}else{if(m[2]=="m"){r=r.replace(m[0],String(d.getMonth()+1).padStart(2,0))}else{if(m[2].indexOf("AG1")!=-1){tmp=m[2].split("-")[1].split(",");if(c.ag1==-1){return -1}r=r.replace(m[0],tmp[c.ag1])}else{if(m[2].indexOf("DIV")!=-1){if(c.DIV==undefined){return -1}r=r.replace(m[0],c.DIV)}}}}}}else{r=r.replace(m[0],"")}}}while(m&&u++<10);return r};b=app.fb_docno_classes[app.fb_doc_types[o].dnc_id];h=b.doc_no_prefix?k(b.doc_no_prefix):"";suffix=b.doc_no_suffix?k(b.doc_no_suffix):"";if(h==-1||suffix==-1){return""}if(l){return h+suffix}a=app.last_doc_nos[b.id];if(a&&a[h+suffix]){n=Number(app.last_doc_nos[b.id][h+suffix])}else{n=Number(b.initial_doc_no)}if(!g){app.last_doc_nos[b.id][h+suffix]=String(n+1)}h=b.doc_no_prefix?k(b.doc_no_prefix,true):"";suffix=b.doc_no_suffix?k(b.doc_no_suffix,true):"";return h+(n+e)+suffix};app.LocalDB={initialize:function(){this.models={}},_refresh_model:function(a,b,c){if(a){this.models[a.urlRoot].fetch({data:$.param(_.extend({pagination:false,limit:100000},b)),success:function(e,d){e.data=d.items?d.items:d;if(d.cols){e.data=_.map(e.data,function(f){return _.object(d.cols,f)})}if(c){c.fn.call(c.context,true,c.data)}},error:function(d,e){console.error('Loading data failed "'+d.urlRoot+'"');if(c){c.fn.call(c.context,false,c.data)}}})}},add_model:function(b){var a;a=new b;this.models[b.prototype.urlRoot]=a},refresh_model:function(b,c,d){var a;a=this.models[b.prototype.urlRoot];this._refresh_model(a,c,d)},filter:function(g,h){var e,d,f,a,k,j,b,c;e=g.data;d=[];c=g.limit||100;a=_.omit(h,g.excl_fields,["_select_fields","pagination"]);for(f in e){j=true;for(k in a){if(e[f][k]&&e[f][k].toString().toLowerCase()!=a[k].toLowerCase()){j=false}}if(j){d.push(e[f])}}if(g.filter){d=g.filter(d,h)}if(d.length>c){d=d.slice(0,c)}return d},order:function(a,b){return a.sort(function(e,d){var c=e[b];var f=d[b];if(typeof c=="string"){c=c.toLowerCase()}if(typeof f=="string"){f=f.toLowerCase()}return((c<f)?-1:((c>f)?1:0))})},has_local:function(a){var c,b;c=/^([a-z A-Z \/]+)(?:(?:[\?])(.*)?)?$/;b=a.match(c);return(b&&b[1]&&this.models[b[1]]&&(this.models[b[1]].without_ws||(app.ws&&app.ws.readyState==WebSocket.OPEN)))},get:function(b){var h,g,f,d,e,a,c;h=/^([a-z A-Z \/]+)(?:(?:[\?])(.*)?)?$/;g=b.match(h);if(g){f=g[1]}a={};if(g.length>2){d=g[2].split("&");for(c=0;c<d.length;c++){e=d[c].split("=");a[e[0]]=e[1]}}model=this.models[f];if(model){result=this.filter(model,a);return result}return null}};app.models.Doc_No=Backbone.Model.extend({urlRoot:"/company/get_doc_nos/"});app.models.VoucherLock=Backbone.Model.extend({urlRoot:"/company/voucher_lock/"});app.models.Item=Backbone.Model.extend({urlRoot:"/items/"});app.models.StockReport=Backbone.Model.extend({urlRoot:"/reports/stock/"});app.models.ItemUnit=Backbone.Model.extend({urlRoot:"/item_units/"});app.models.ServiceItem=Backbone.Model.extend({urlRoot:"/items/",sync:function(c,b,a){if(c=="read"){a.data=$.param(_.extend($.deparam(a.data),{is_service:true}))}else{b.set({is_service:true})}return Backbone.sync.call(this,c,b,a)}});app.models.ItemCategory=Backbone.Model.extend({urlRoot:"/item_categories/"});app.models.ItemBrand=Backbone.Model.extend({urlRoot:"/item_brands/"});function gen_model(a){return Backbone.Model.extend({urlRoot:a})}app.models.Account=Backbone.Model.extend({urlRoot:"/accounts/",order_by:"name",excl_fields:["name","no_genfields"],cmp_fn:function(d,c){return d.name<c.name},filter:function(a,c){var f,d,b,e;if(c.id){for(d=0;d<a.length;d++){if(a[d].id==Number(c.id)){return a[d]}}return null}if(c.is_cntlacc){f=[];for(d=0;d<a.length;d++){if(a[d].is_cntlacc==(c.is_cntlacc=="true"||c.is_cntlacc==true)){f.push(a[d])}}a=f}if(c.name){f=[[],[]];b=c.name.toLowerCase();for(d=0;d<a.length;d++){e=a[d].name.toLowerCase().indexOf(b);if(e!=-1){f[e==0?0:1].push(a[d])}}f[0].sort(this.cmp_fn);f[1].sort(this.cmp_fn);for(d=0;d<f[1].length;d++){f[0].push(f[1][d])}a=f[0]}return a}});app.models.AccountGroup=Backbone.Model.extend({urlRoot:"/account_groups/"});app.models.AccountSummary=Backbone.Model.extend({urlRoot:"/account_summary/"});app.models.BankAccount=Backbone.Model.extend({urlRoot:"/bank_accounts/"});app.models.Member=Backbone.Model.extend({urlRoot:"/members/"});app.models.Reference=Backbone.Model.extend({urlRoot:"/references/"});app.models.Customer=Backbone.Model.extend({urlRoot:"/cust_n_vendor/customers/"});app.models.Vendor=Backbone.Model.extend({urlRoot:"/cust_n_vendor/suppliers/"});app.models.SubContr=Backbone.Model.extend({urlRoot:"/cust_n_vendor/subcontr/"});app.models.Transaction=Backbone.Model.extend({urlRoot:"/transactions/",url:"/transactions/"});app.models.Voucher=Backbone.Model.extend({urlRoot:"/vouchers"});app.models.VoucherType=Backbone.Model.extend({urlRoot:"/vtypes/",sync:function(d,b,a){if(d=="create"){var c=new FormData();_.each(b.attributes,function(f,e){c.append(e,f)});_.defaults(a||(a={}),{data:c,processData:false,contentType:false})}return Backbone.sync.call(this,d,b,a)}});app.models.DocNoClass=Backbone.Model.extend({urlRoot:"/docno_classes/"});app.models.JournalVoucher=Backbone.Model.extend({urlRoot:"/journal_vouchers/"});app.models.DebitNote=Backbone.Model.extend({urlRoot:"/debit_notes/"});app.models.CreditNote=Backbone.Model.extend({urlRoot:"/credit_notes/"});app.models.AccessList=Backbone.Model.extend({urlRoot:"/access_lists/"});app.models.AccessGroup=Backbone.Model.extend({urlRoot:"/access_groups/"});app.models.MonthlyTarget=Backbone.Model.extend({urlRoot:"/monthly_targets/"});app.models.WorkingDays=Backbone.Model.extend({urlRoot:"/working_days/"});app.has_permission=function(a){return true};app.models.Bill=Backbone.Model.extend({urlRoot:"/bills/"});app.models.Invoice=Backbone.Model.extend({urlRoot:"/invoices/"});app.models.PaymentVoucher=Backbone.Model.extend({urlRoot:"/payment_vouchers/"});app.models.Receipt=Backbone.Model.extend({urlRoot:"/receipts/"});app.models.TrialBalance=Backbone.Model.extend({urlRoot:"/reports/trial_balance/"});app.models.Employee=Backbone.Model.extend({urlRoot:"/employees/"});app.models.Department=Backbone.Model.extend({urlRoot:"/departments/"});app.models.Designation=Backbone.Model.extend({urlRoot:"/designations/"});app.models.AdminWing=Backbone.Model.extend({urlRoot:"/admin_wings/"});app.fn={};app.fn.get_account_list=function(c,d,b){var a=new app.models.Account;a.fetch({data:$.param({name:c}),success:function(h,e){var g=e.items,i,f=[];for(i in g){f.push(g[i].name)}d.call(b,f)},error:function(){alert("Error in getting account list")}})};app.fn.get_vendor_list=function(c,d,b){var a=new app.models.Vendor;a.fetch({data:$.param({name:c}),success:function(h,e){var g=e.items,i,f=[];for(i in g){f.push(g[i].name)}d.call(b,f)},error:function(){alert("Error in getting account list")}})};function iframe_write(b,a){b=b.contentWindow||b.contentDocument.document||b.contentDocument;b.document.open();b.document.write(a);b.document.close()}app.utils={print_content:function(b,a){$(".print_iframe").remove();var c=document.createElement("iframe");c.style="position:absolute;top:0;left:0;width:0;height:0;opacity:0;pointer-events:none";c.className="print_iframe";document.body.appendChild(c);c.contentWindow.document.open();c.contentWindow.document.write(b);c.contentWindow.document.close();setTimeout(function(){var d;d=document.title;document.title=c.contentWindow.document.title;c.contentWindow.print();document.title=d;setTimeout(function(){document.body.removeChild(c)},100)},300)},load_iframe:function(a){$(".print_iframe").remove();var b=document.createElement("iframe");b.style="position:absolute;top:0;left:0;width:0;height:0;opacity:0;pointer-events:none";b.src=a;b.className="print_iframe";document.body.appendChild(b);setTimeout(function(){document.body.removeChild(b)},500)},show_print_box:function(a){var b=window.open("","","menubar=0");b.document.write(a);b.document.close()}};(function(b,a){var c;c=function(d){return b.extend(d)};_.extend(a,{Godown:c({urlRoot:"/godowns/"}),StockJournal:c({urlRoot:"/stock_journals/"}),SalesQuotation:c({urlRoot:"/sales_quotations/"}),ProfomaInvoice:c({urlRoot:"/profoma_invoices/"}),PurchaseOrder:c({urlRoot:"/purchase_orders/"}),DeliveryNote:c({urlRoot:"/delivery_notes/"}),GRN:c({urlRoot:"/grns/"}),StockOpening:c({urlRoot:"/stock_opening/"}),GoodsIssue:c({urlRoot:"/goods_issue/"}),GTO:c({urlRoot:"/gto/"}),GT:c({urlRoot:"/goods_trans/"}),SaleOrder:c({urlRoot:"/sale_orders/"}),CustContract:c({urlRoot:"/cust_contracts/"}),SupplContract:c({urlRoot:"/suppl_contracts/"}),BOQ:c({urlRoot:"/boqs/"}),BOQ_Variation:c({urlRoot:"/boq_variations/"}),CntInv:c({urlRoot:"/cnt_invoices/"}),SubCntInv:c({urlRoot:"/subc_invoices/"})})})(Backbone.Model,app.models);function before_init(){var a;app.main_content_clone=$("main.main_content_area").clone()}function after_init(){};jQuery.fn.tagName=function(){return this.prop("tagName").toLowerCase()};jQuery(".main_content_area").on("click","a",function(a){a.preventDefault()});app.eventBus=_.extend({},Backbone.Events);function do_periodic_check(){var a;a=new Backbone.Model;a.url="/periodic_check/";a.fetch({success:function(){},error:function(){}})}setInterval(do_periodic_check,1000*60*30);do_periodic_check();_.extend(Backbone.Collection.prototype,{create_item:function(b,a){a=a?_.clone(a):{};var c=a.wait;b=this._prepareModel(b,a);if(!b){return false}var d=this;if(!a.success){a.success=function(){}}b.save(null,a);return b}});app.pages={current_page:null,is_focusable:false,show_page:function(a){if(this.current_page!=null){this.current_page.trigger("hide");this.current_page.$el.hide()}a.$el.show();this.$el=a.$el;this.children=[a];this.current_page=a;app.focus_handler.page_changed();scroll_handler()}};function wacky_round(c,a){var d=Math.pow(10,a+2),b=Math.floor(c*d);b+=44;b=Math.floor(b/100);return b/Math.pow(10,a)}app.globals={items:{},register:function(a,c,b){if(a in this.items){return false}this.items[a]={context:b,fn:c};return true},get:function(a){if(a in this.items){return this.items[a]}else{return null}},call:function(b,a){var c=this.items[b];return c.fn.call(c.context,a)}};app.opened_dropdown=null;app.opened_tooltip=null;app.last_pp_cls_prv_time=0;function popup_close_handler(c){var b,d,a;if(c.timeStamp-app.last_pp_cls_prv_time<300){return}if(app.opened_dropdown){d=$(c.target);b=d.closest(".dropdown").length?d.closest(".dropdown").data("parent"):null;a=app.opened_dropdown.closest(".dropdown");if(!d.closest(a).length&&(b?!(b.closest(a).length):true)){app.opened_dropdown.hide();app.opened_dropdown=null}}if(app.opened_menu&&app.opened_menu.onclose){d=$(c.target);a=app.opened_menu.context.$el;if(!d.closest(a).length){app.opened_menu.onclose.call(app.opened_menu.context)}}}app.set_dropdown=function(a){if(app.opened_dropdown){app.opened_dropdown.hide()}app.opened_dropdown=a};function swap(d,c){var e;e=d;d=c;c=e}function us_swap(c,b){var a;a=c[b];c[b]=c["_"+b];c["_"+b]=a}function swap_obj_keys(f,d,c){var e;e=f[d];f[d]=f[c];f[c]=e}app.qcreate_items={};app.QuickCreate_Add=function(b,a,c){$("#quickcreate_dropdown .qcd__ul").append($('<li><a href="#'+b+'" data-id="'+b+'">"'+a+'"</a></li>'));app.qcreate_items[b]={callback:c}};$(document).on("focus","input,textarea",function(a){setTimeout(function(){popup_close_handler(a)},100)});$(document).on("mousedown",".mfp-wrap",function(d){var c,b,a,f;c=$(d.target).closest(".popup_head");if(c.length!=0){b=c[0].getBoundingClientRect();a=d.clientX-b.left;f=d.clientY-b.top;app.drag_info={top:f,left:a}}});$(document).on("mouseup",".mfp-wrap",function(a){app.drag_info=null});function scroll_handler(d){var a,b,c;if(app.Popup.prototype.opened_popups.length==0){a=app.pages.current_page.$el.find(".component.DS:visible");if(a.length==1){b=$(".app_header").outerHeight();c=a.find(".ds_head_cnt_innr");if(a.find(".ds_container")[0].getBoundingClientRect().top<b){if(!c.data("isFixed")){c.parent().css({height:c.height()});c.css({position:"fixed",top:b,width:c.width()}).data("isFixed",true)}}else{c.css({position:"initial"}).data("isFixed",false)}}}}$(document).on("scroll",scroll_handler);$(document).on("mousemove",".mfp-wrap",function(b){var a;if(b.buttons==1&&app.drag_info){a=app.Popup.prototype.opened_popups.length?app.Popup.prototype.opened_popups[app.Popup.prototype.opened_popups.length-1]:null;if(a){a.$el.css({left:(b.clientX-app.drag_info.left)+"px",top:(b.clientY-app.drag_info.top)+"px"})}}});$(document).on("visibilitychange",function(b){if(document.visibilityState==="visible"){var a=gen_model("/company/get_scope_cid/");(new a).fetch({success:function(d,c){if(app.appdata.scope!=undefined){if(c.scope.toString()!=app.appdata.scope){location.reload()}}if(c.cid==null||c.cid.toString()!=app.appdata.cid){if(c.cid.toString()!=app.appdata.cid){alert("You have been logged in to different branch in another tab, updating to new branch...")}location.reload()}}})}});app.drag_hook={position:{},$el:null};$(document).on("click",function(d){var c,b,a;c=$(d.target);b=c.closest(".component");if(b.length){a=b.data("backbone_view");if(a){app.focus_handler.focus_comp(a)}}else{b=app.focus_handler.current_focused_comp;if(b){b.$el.removeClass("focused")}}popup_close_handler(d)});app.resize_timer=null;app.resize_fn=function(){var a;a=app.pages.current_page.$el.find(".component.DS:visible").data("backbone_view");a.onresize()};$(window).on("resize",function(a){if(app.resize_timer){clearTimeout(app.resize_timer);app.resize_timer=null}app.resize_timer=setTimeout(app.resize_fn,100)});function release_component(a){if(app.opened_tooltip){if(!jQuery.contains(app.opened_tooltip_cnt,$(a.target))){app.opened_tooltip.hide()}}}$(document).on("mouseout .component",release_component);app.TopButtons=new (Backbone.View.extend({el:$("#header-buttons"),events:{click:"el_clicked"},set:function(a){this.$el.find("._print_btn")[_.contains(a,"print")?"removeClass":"addClass"]("disabled");this.$el.find("._export_btn")[_.contains(a,"export")?"removeClass":"addClass"]("disabled")},el_clicked:function(b){var a=$(b.target);if(app.pages.current_page&&app.pages.current_page[a.data("op")]){app.pages.current_page[a.data("op")]()}}}));app.SideMenu=new (Backbone.View.extend({events:{click:"element_clicked"},focused_el:null,initialize:function(a){this.listenTo(app.eventBus,"purchase_request_clicked",this.purchase_request_click)},gl_ev_handler:function(f,g){var i,d,c,h;var b,a;a=function(j){var e;e=j.parent().children(":not(.disabled)");return e.index(j)==e.length-1};b=function(j){var e;e=j.parent().children(":not(.disabled)");return e.index(j)==0};if(f=="focused"){if(!this.focused_el){this.focused_el=this.$el.children(":not(.disabled)").first();this.focused_el.addClass("focused")}}else{if(f=="blurred"){this.focused_el.find("a")[0].blur();this.$el.find("li").removeClass("focused")}else{if(f=="keypress"){h=this.$el.children(":not(.disabled)");i=this.focused_el||h.first();switch(g.keyCode){case 40:case 38:if(g.keyCode==40){if(i.hasClass("open")){i=i.find("li:not(.disabled)").first()}else{if(a(i)){c=i.parent().closest(".aside_menu > li");if(c.length>0&&!a(c)){i=c.nextAll(":not(.disabled):first")}else{i=this.$el.find(">li:not(.disabled)").first()}}else{i=i.nextAll(":not(.disabled):first")}}}else{if(b(i)){c=i.parent().closest(".aside_menu > li");if(c.length>0){i=c}if(b(i)){i=this.$el.find(">li:not(.disabled)").last()}if(i.hasClass("open")&&c.length==0){i=i.find("li:not(.disabled)").last()}}else{i=i.prevAll(":not(.disabled):first")}}this.$el.find("li").removeClass("focused");i.addClass("focused");this.focused_el=i;i.find("a")[0].focus();break;case 37:case 39:if(g.keyCode==39){if(i.hasClass("asmenu_li_hasmenu")){this.$el.find("li.open").removeClass("open");i.addClass("open");i=i.find("li").first();if(i.is(".disabled")){i=i.prev(":not(.disabled)")}}}else{if(g.keyCode==37){if(i.hasClass("asmenu_li_hasmenu")){this.$el.find("li.open").removeClass("open");i.addClass("open")}else{c=i.parent().closest(".aside_menu > li");if(c.length){i=c}}i.removeClass("open")}}this.$el.find("li").removeClass("focused");i.addClass("focused");this.focused_el=i;i.find("a")[0].focus();break}}}}},element_clicked:function(f){var d=$(f.target).parent(),c,b,a;c=d.closest(".asmenu_li_hasmenu");b=d.closest("li");f.preventDefault();if(this.focused_el){this.focused_el.removeClass("focused")}b.addClass("focused");this.focused_el=b;if(c.length!=0){this.$el.find("li.open").not(c).removeClass("open")}if(d.hasClass("asmenu_li_hasmenu")&&$(f.target).tagName()=="a"){d.hasClass("open")?d.removeClass("open"):d.addClass("open")}a=b.find("a").attr("href");if(a.indexOf("#")!=-1){app.router.navigate(a,{trigger:true})}},removeAll:function(){this.$el.html("")},add_item:function(a){var e,c,d,b;c=this.$el;b=c.find("li").filter(function(){return $(this).data("id")==a.item_id});if(a.replace&&b.length>0){b.remove();b=[]}if(b.length==0){e=$("<li "+(a.is_disabled?"class = 'disabled'":"")+"data-index='"+(a.index?a.index:0)+"' data-id='"+(a.item_id?a.item_id:"")+"'><a draggable='false' "+(a.view?"href='#/view/"+a.view+"?cl_opt=true'":"href=javascript:void(0)")+">"+(a.icon?'<i class="aside_icon '+a.icon+'"></i>':"")+a.label+"</a></li>")}else{if(b.hasClass("disabled")&&!a.is_disabled){e=b.eq(0);e.removeClass("disabled")}else{return}}if(a.callback){e.on("click",a.callback)}if(a.under){b=c.find("li").filter(function(){return $(this).data("id")==a.under}).eq(0);if(b.length>0){if(!b.hasClass("asmenu_li_hasmenu")){b.append($("<ul class='aside_menu aside_menu_l2'></ul>"));b.addClass("asmenu_li_hasmenu")}c=b.find("ul")}else{return}}if(a.index!="undefined"){d=c.children().filter(function(){return $(this).data("index")>a.index}).eq(0);if(d.length==0){c.append(e)}else{e.insertBefore(d)}}else{c.append(e)}}}))({el:$("#aside_menu")});app.TopMenu=new (Backbone.View.extend({events:{"click .dropdown-icon":"element_clicked"},opened_dropdown:null,initialize:function(a){},element_clicked:function(c){var b=$(c.target).closest(".component");switch(b.data("component-type")){case"dropdown":var a=b.find(".dropdown-box");if(a.is(":visible")){a.hide();app.set_dropdown(null)}else{a.show();app.set_dropdown(a)}break}}}))({el:$("#header_right")});app.focus_handler={top_level_comps:[app.SideMenu,app.pages,app.TopMenu],current_focused_comp:null,focus_stack:[],init:function(){var a=this;$(document).on("keydown",function(b){a.key_handler("keyup",b)});$(document).on("keyup",function(b){a.key_handler("keydown",b)});$(document).on("focusin",function(b){a.focus_handler("focusin",b)});$(document).on("focusout",function(b){a.focus_handler("focusout",b)})},page_changed:function(a){if(this.current_focused_comp&&this.current_focused_comp.$el.closest("main").length!=0){this.focus_comp(app.pages,true,a)}},focus_comp:function(a,c,b){c_comp=this.current_focused_comp;while(a){tmp=_.isFunction(a.children)?a.children():a.children;if(a.is_dynamic_load&&c&&!b){return}if((a.is_focusable==false||a.pass_through)&&tmp&&tmp.length){a=tmp[0]}else{break}}if(c_comp){c_comp.$el.removeClass("focused");if(c_comp.gl_ev_handler){c_comp.gl_ev_handler("blurred")}}a.$el.addClass("focused");if(a.gl_ev_handler){a.gl_ev_handler("focused")}this.current_focused_comp=a},tab_handler:function(h){var c,f,a,j,k,g;var b=$(document.activeElement);if(b.closest(".popup").length>0){return}if(b.closest("form").length>0){var d=b.closest("form").find('button:not([disabled]):visible, input:not([disabled]), [tabindex]:not([disabled]):not([tabindex="-1"])');if(b[0]!=d[d.length-1]){return}else{b.blur();h.preventDefault()}}else{h.preventDefault()}j=this.current_focused_comp;if(this.focus_stack.length==0){a=this.top_level_comps}else{a=this.focus_stack[this.focus_stack.length-1].children}if(j==null){c=a[0]}else{f=a.indexOf(j);c=(f<a.length-1&&f!=-1?a[f+1]:a[0])}this.focus_comp(c)},arrow_key_handler:function(b){var a=this.current_focused_comp;var c=$(document.activeElement);if(c.closest(".popup").length>0||c.closest("input").length>0){return}if(a.$el.closest("main").length==0&&b.keyCode!=13){b.preventDefault()}if(a.gl_ev_handler){return a.gl_ev_handler(b.type,b)}},focus_handler:function(d,f){var c=$(f.target),b,a;if(c.closest(".component").length){b=c.closest(".component").data("backbone_view");a=d=="focusin";if(b){b.$el[a?"addClass":"removeClass"]("focused");if(a){if(b.focusin_handler){comb.focusin_handler(f)}}else{if(b.check_fill){b.check_fill(c)}if(b.focusout_handler){b.focusout_handler(f)}}if(b.trigger_event){b.trigger_event(d,b,f,null)}}}},key_handler:function(d,f){var a,c,b;b=app.Popup.prototype.opened_popups;if(b.length>0){c=$(f.target);if(c.closest("input:visible:enabled,textarea:visible:enabled,button:visible,select:visible").length==0){if(f.keyCode==9||f.keyCode==8){if(f.keyCode==9){b[b.length-1].focus_popup()}f.preventDefault()}}if(d=="keydown"){b[b.length-1].gl_ev_handler(d,f)}}switch(f.keyCode){case 9:if(d=="keyup"){return this.tab_handler(f)}case 40:case 38:case 37:case 39:case 13:case 16:return this.arrow_key_handler(f)}}};function isElement(b){try{return b instanceof HTMLElement}catch(a){return(typeof b==="object")&&(b.nodeType===1)&&(typeof b.style==="object")&&(typeof b.ownerDocument==="object")}}app.ws_ev_handler=function(a){switch(a.data){case"accounts_updated":app.LocalDB.refresh_model(app.models.Account);break;case"workbook_changed":window.location.reload();break}};var app=app||{};app.components={};app.component_types={};(function(){var el_id_counter=0;var default_comp_attr={id:"",no_outer:false,label:"input label",class_name:"_type1 _md",tabindex:"",name:"",el_id:"el_id_"};var Backbone_View=Backbone.View;var InputComponent=Backbone_View.extend({base_template:_.template($("#template_cmp").html()),cmp_msg_template:_.template('<span class="cmp_msg <%=msg_type%>" generated="true"><%= msg %></span>'),init_component:function(options,type){var ip_options,ip_defaults,component_types,obj,template_data,comp_el,tmp,i,tmp2;if(!options){options={}}ip_options=options.options||{};ip_defaults=ip_options.defaults||{};this.scope=options.scope;_.extend(this,_.pick(ip_options,["type","no_focus","disabled","always_disable","skipped","hidden","extra"]));if(this.always_disable){this.disabled=ip_options.disabled=true}if(type){ip_options.type=type}component_types=app.component_types;this.dlgTo=ip_options.dlgTo;this.name=ip_options.name;if(!("el" in options)){this.undelegateEvents();if(!(ip_options.type in component_types)){return null}obj=_.extend({},default_comp_attr,ip_defaults,ip_options);obj.el_id="el_id_"+el_id_counter++;this._renderdata=obj;template_data={input_types:component_types,cmp:obj};comp_el=$(this.base_template(template_data));this._setElement(comp_el);this.$el.on("focusout","input",function(e){var el=$(e.target).closest(".component");el.find(".error_msg").remove();el.removeClass("error")})}if(ip_options.handle_events){this.events=_.clone(this.events);tmp={};for(i in ip_options.handle_events){this.events[ip_options.handle_events[i]+" input"]="_delegated_handler"}this.delegateEvents(this.events)}else{if(!("el" in options)){this.delegateEvents()}}this.input_el=this.ip_el_selector!=""?this.$el.find(this.ip_el_selector):this.$el;return this.$el},set_value:function(value,options){var status;status=this._set_value(value,options);this.$el[(status!=-1&&value!==null&&value!=="")?"addClass":"removeClass"]("filled");return this},set_label:function(label){this.$el.find("label").text(label)},check_fill:function(el){var el;try{if(el.is(":-webkit-autofill")){el.closest(".component").addClass("filled");return}}catch(err){}if(el.val()!=""){el.closest(".component").addClass("filled")}else{el.closest(".component").removeClass("filled")}},trigger_event:function(){var dlgTo=this.dlgTo;this.trigger.apply(this,arguments);if(dlgTo){if(_.isFunction(dlgTo)){dlgTo.apply(this.scope,arguments)}else{if(dlgTo=="scope"){dlgTo=this.scope}if(dlgTo.dlg_handler){dlgTo.dlg_handler.apply(dlgTo,arguments)}else{dlgTo.trigger.apply(dlgTo,arguments)}}}},_delegated_handler:function(e){this.trigger_event(e.type,this,e)},render_error:function(err){this.$el.removeClass("error").find(".cmp_msg").remove();if(err){this.$el.addClass("error");this.$el.append($(this.cmp_msg_template({msg_type:"error_msg",msg:err})))}return this},render_info:function(info){this.$el.removeClass("error").find(".cmp_msg").remove();if(info){this.$el.addClass("error").append($(this.cmp_msg_template({msg_type:"info_msg",msg:info})))}return this},release:function(){this.scope=null;this.remove()},focus:function(is_select){this.input_el.focus();if(is_select){this.input_el.select()}return this},reset:function(){this.set_value("")},blur:function(){this.input_el.blur();return this},hide:function(use_css_visibilty){if(use_css_visibilty==true){this.$el.css("visibility","hidden")}else{this.$el.hide()}return this},show:function(use_css_visibilty){if(use_css_visibilty==true){this.$el.css("visibility","visible")}else{this.$el.show()}return this},disable:function(){this.disabled=true;this.$el.addClass("disabled");this.input_el.prop("disabled",true);return this},enable:function(){this.disabled=false;this.$el.removeClass("disabled");this.input_el.prop("disabled",false);return this},render:function(){var template_data,comp_el;template_data={input_types:app.component_types,cmp:this._renderdata};comp_el=$(this.base_template(template_data));comp_el.insertBefore(this.$el);this.$el.remove();this.setElement(comp_el);this.input_el=this.ip_el_selector!=""?this.$el.find(this.ip_el_selector):this.$el},register:function(type,view_name,constructor){var app_cmp_types=app.component_types;this.template=_.template($(this.template_el).html());app.components[view_name]=constructor;app_cmp_types[type]={template:this.template,view:constructor}}});app.components.InputComponent=InputComponent;var ButtonView=InputComponent.extend({events:{click:"clicked"},template_el:"#template_ip_btn",ip_el_selector:"",initialize:function(options){options.options.no_outer=true;this.init_component(options,"button")},clicked:function(e){this.trigger_event("clicked",this,e)},get_value:function(){return this.$el.data("val")},_set_value:function(value){this.$el.data("val",value)},set_label:function(label){this.$el.text(label)}});ButtonView.prototype.register("button","Button",ButtonView);var InputBoxView=InputComponent.extend({events:{"keyup input":"keyup","keydown input":"keydown"},template_el:"#template_ip_ipbx",ip_el_selector:"input",initialize:function(options){this.init_component(options,"inputbox");_.extend(this,_.pick(options.options,["thousand_sep","dp","calc_exp"]));if(this.thousand_sep){this.$el.find(".ipbx_label").before('<span class="ipbx_thsep"></span>')}},keyup:function(e){this.trigger_event("keyup",this,e)},set_thousands:function(val){this.$el.find(".ipbx_thsep").text(val==""||val==null||isNaN(val)?"":to_money(val,false,this.dp||2))},focusout_handler:function(e){var val;if(this.thousand_sep){val=this.get_value();this.set_thousands(val)}},keydown:function(e){var res,flag;flag=false;if(e.keyCode==13&&this.calc_exp&&/^([0-9 \+ \. \- \/ \* \( \)]+)$/.test(this.get_value())){res=eval(this.get_value());if(!isNaN(res)){this.set_value(wacky_round(res,2));flag=true}}this.trigger_event("keydown",this,e);if(flag){this.trigger_event("keyup",this,e)}},get_value:function(){return this.input_el.val()},_set_value:function(value){this.input_el.val(value);if(this.thousand_sep){this.set_thousands(value)}this.trigger_event("value_set",this,null)}});InputBoxView.prototype.register("inputbox","InputBox",InputBoxView);var ComboBoxView=InputComponent.extend({template_el:"#template_ip_cmpbx",events:{"keyup .cmbx_ip":"keyup","keydown .cmbx_ip":"keydown","click .cmbx_arrow":"arrow_click","click .cmbx_search":"search_click"},ip_options:{},li_height:null,embedd_list_el:true,option_template:_.template("<div class='cmbx_ul_cnt'><ul class='cmbx_ul'><%_.each(list,function(option){%><li title='<%=option.label%>'><%if(info_enabled){%><i><%=option.info%></i><%}%><span><%=option.label%></span></li><%})%><% if(new_item_btn){ %><li><span class='cmbx_btn cmbx_newbtn'><i>Add New Item</i></span></li><% } %><% if(eol_btn){ %><li><span class='cmbx_btn cmbx_eolbtn'><i>End of List</i></span></li><% } %></ul></div>"),list_selector:"items",label_sel:"name",embedd_list_el:false,ip_el_selector:"input",initialize:function(options,defaults){var tmp;_.extend(this,{url_args:{}},_.pick(options.options,["parse","get_list","url_args","list_selector","info_format","root_url","srch_def_args","auto_show_info","en_search_by","new_item_btn","eol_btn","label_sel","value_sel","info_sel","embedd_list_el","options","url","use_local","skip_text_change","name","dropdown_width","keydown_pretrigger","no_menu_on_arrow"]));this.init_component(options,"combobox");if(!this.value_sel){this.value_sel=this.label_sel}if(this.embedd_list_el==true){this.drop_el=this.$el.find(".cmbx_dropdown");this.is_embedd=true}else{this.drop_el=$("#global_dropdown_container");this.is_embedd=false}this.arrow_el=this.$el.find(".cmbx_arrow")},parse:function(response){var list=response,list_sel,flag;list_sel=this.list_selector;flag=false;if(list_sel&&list_sel!=""&&response[list_sel]){flag=true;list=response[list_sel]}if(response.cols&&!response.objfied){list=_.map(list,function(itm){return _.object(response.cols,itm)})}if(flag){response[list_sel]=list;response.objfied=true}return list},release:function(){this.scope=null;this.ip_options=null;this.get_list=null;if(this.drop_el){this.drop_el.off("click");this.drop_el=null}this.remove()},focusout_handler:function(e){var val,self;self=this;if(self.selected_value==null){if(!self.setnull_timer){self.setnull_timer=setTimeout(function(){if(!self.menu_open){self.reset()}self.setnull_timer=null},250)}}},get_value:function(options){var self,sel_val;self=this;sel_val=self.selected_value;if(options){if(options.t2){return[sel_val||sel_val==0?sel_val:"",self.input_el.val()]}else{if(options.ip_value){return self.input_el.val()}}}else{return sel_val||sel_val==0?sel_val:""}},_set_value:function(value,data){var val,label,self;self=this;if(_.isArray(value)){val=value[0];label=value[1]}else{label=val=value}self.data=data||null;self.selected_value=val||null;self.arrow_el[(val&&val!="")?"addClass":"removeClass"]("cmbx_close");if(self.en_search_by){self.$el.find(".cmbx_search")[(val&&val!="")?"addClass":"removeClass"]("cmbx_detbtn")}self.input_el.val(label);if(val==null||val==undefined){return -1}},list_trfm:function(data){var list,sublist,i,sub_itm,cols;list=this.parse(data);sublist=[];for(i=0;i<list.length;i++){sub_itm={label:this.label_sel?list[i][this.label_sel]:list[i],value:this.value_sel?list[i][this.value_sel]:list[i]};if(this.info_sel){sub_itm.info=list[i][this.info_sel]}sublist.push(sub_itm)}return sublist},get_list:function(value,callback,context){var list,self,model,arg;list=[];self=this;if(this.url){if(!self._disable_dd){self._disable_dd=true;var model=new Backbone.Model,fetched=false,self=this,text_modified=false;model.url=self.url.replace("{{value}}",encodeURIComponent(value).replace(/'/g,"%27"));if(self.url_args){for(arg in self.url_args){model.url=model.url.replace("{{"+arg+"}}",!self.url_arg_no_encode?encodeURIComponent(self.url_args[arg]):self.url_args[arg])}}if(self.use_local&&app.LocalDB.has_local(model.url)){self._disable_dd=false;self.data=app.LocalDB.get(model.url);sublist=self.list_trfm(self.data);callback.call(context,sublist)}else{if(self.timer){clearTimeout(self.timer)}if(self.timer2){clearTimeout(self.timer2)}self.timer=setTimeout(function(){self._disable_dd=false;self.timer=null;if(value!=self.get_value({ip_value:true})){self.get_list(self.get_value({ip_value:true}),callback,context)}},200);self.timer2=setTimeout(function(){if(!fetched&&value!=self.get_value({ip_value:true})){self.show_dropdown();self.drop_el.html("<div class='cmbx_drop_innr'><span class='cmbx_loading'>Loading...</span></div>")}},400);if(self.xhr){self.xhr.abort()}self.xhr=model.fetch({success:function(model,response){self.$el.find(".error_msg").remove();self.data=response;self.xhr=null;fetched=true;sublist=self.list_trfm(self.data);callback.call(context,sublist)},error:function(model,error){fetched=true;self.xhr=null;self.render_error("Retriving list failed")}})}}}else{if(this.options){var options=this.options,pattern=new RegExp("^"+value,"i"),len=0;for(option in options){if(len>(this.limit||6)){break}if(pattern.test(options[option])){list.push({label:options[option],value:options[option]});len++}}setTimeout(function(){callback.call(context,list)},50)}}},get_selected_data:function(){var list,li,current_val;if(!this.data){return null}list=this.parse(this.data);current_val=this.get_value();if(this.value_sel){for(li in list){if(list[li][this.value_sel]==current_val){return list[li]}}}else{for(li in list){if(list[li]==current_val){return list[li]}}}return null},emul_itemselect:function(){this.get_list(this.get_value({ip_value:true}),function(){this.trigger_event("item_selected",this,null,{})},this)},render_list:function(list){var dropdown_html,self,selected_item;self=this;if(list.length>0||this.new_item_btn||this.eol_btn){dropdown_html=this.option_template({list:list,new_item_btn:this.new_item_btn,eol_btn:this.eol_btn,info_enabled:this.info_sel});selected_item=this.drop_el.find("li.selected")}else{dropdown_html="<div class='cmbx_drop_innr'><span class='cmbx_noitem'>No Items</span></div>"}this.drop_el.html(dropdown_html);if(list.length>0||this.new_item_btn){this.drop_el.find("li").eq(selected_item.length?selected_item.eq(0).index():0).addClass("selected")}if(list.length>0||this.new_item_btn){this.drop_el.off("click").on("click","li",function(e){var el,value;el=$(e.target);self.li_clicked(e)})}},show_dropdown:function(callback){var self,position,ip_el,flag,drop_height,drop_min_height,drop_max_height,li_height,tmp1,tmp2;if(!this.input_el.is(":focus")){return}if(this.menu_open){this.drop_el.hide()}self=this;li_height=_.proto(this).li_height;if(!li_height){this.drop_el.show();tmp1=this.drop_el.find("li:nth-child(1)").outerHeight();tmp2=this.drop_el.find("li:nth-child(2)").outerHeight();_.proto(this).li_height=li_height=(tmp2<tmp1?tmp2:tmp1);this.drop_el.hide()}drop_max_height=li_height*10;drop_min_height=li_height*7;if(!this.is_embedd){if(this.input_el.offset().top+this.input_el.height()+drop_min_height-window.scrollY>window.innerHeight){drop_height=this.drop_el.find("li").length*li_height;if(drop_height>drop_max_height){drop_height=drop_max_height}else{drop_height=drop_height-drop_height%li_height}position={top:Math.ceil(this.input_el.offset().top-drop_height-5),maxHeight:drop_height,left:this.$el.offset().left,width:this.dropdown_width?this.dropdown_width:this.$el.width()};flag=1}else{drop_height=Math.ceil($(window).height()-(this.input_el.offset().top-window.scrollY+this.input_el.outerHeight())-5);if(drop_height>drop_max_height){drop_height=drop_max_height}else{drop_height=drop_height-drop_height%li_height}position={top:Math.ceil(this.input_el.offset().top+this.input_el.outerHeight()),maxHeight:drop_height,left:this.$el.offset().left,width:this.dropdown_width?this.dropdown_width:this.$el.width()};flag=0}this.drop_el.css(position);this.drop_el.data("parent",this.$el)}this.menu_open=true;this.drop_el.show();app.opened_menu={context:this,onclose:function(){if(this.drop_el){this.drop_el.html("").hide()}this.menu_open=false}}},hide_dropdown:function(){this.drop_el.html("").hide();app.opened_menu=null;this.menu_open=false},select_item:function(keyCode){var selected_item,index,list,new_index,item_height,li,ul_el,scrolltop;selected_item=this.drop_el.find("li.selected");list=this.drop_el.find("li");if(selected_item.length>0){index=selected_item.eq(0).index()}else{index=-1}if(keyCode==40){if(index+1>list.length-1){new_index=0}else{new_index=index+1}}if(keyCode==38){if(index-1<0){new_index=list.length-1}else{new_index=index-1}}item_height=list.eq(0).outerHeight();li=list.removeClass("selected").eq(new_index).addClass("selected");ul_el=this.drop_el.find(".cmbx_ul_cnt");scrolltop=ul_el.scrollTop();if(new_index*item_height<scrolltop){ul_el.scrollTop(new_index*item_height)}else{if(new_index*item_height+li.outerHeight()>scrolltop+this.drop_el.height()){ul_el.scrollTop(new_index*item_height+li.outerHeight()-this.drop_el.height())}}},keydown:function(e){var selected_item;if(this.keydown_pretrigger){this.trigger_event("before_keydown",this,e,{})}if(this.menu_open){if((e.keyCode==38||e.keyCode==40)){e.stopPropagation();this.select_item(e.keyCode);return}else{if(e.keyCode==13){e.preventDefault();selected_item=this.drop_el.find("li.selected");if(selected_item.length>0){this.item_selected(selected_item.find("SPAN"),e)}else{this.hide_dropdown()}}else{if(e.keyCode==27){this.hide_dropdown()}}}}else{if(this.get_value({ip_value:true}).length==0&&_.contains([32],e.keyCode)){var list=this.get_list("",function(list){if(this.data&&!_(this.parse(this.data)).isEqual(list)){this.render_list(list);this.show_dropdown()}},this);return false}}this.trigger_event("keydown",this,e,{})},keyup:function(e){var value,flag;if(e.keyCode==38||e.keyCode==40){e.stopPropagation();if(this.$el.closest(".component.inputsheet").length>0||(this.no_menu_on_arrow&&!this.menu_open)){return}}if(_.contains([38,40],e.keyCode)&&!this.menu_open){e.preventDefault()}else{if(_.contains([8,46],e.keyCode)){this.selected_value=null;if(this.auto_show_info){this.show_info(null,null)}}else{if(this.skip_text_change||!(is_charkey(e))){flag=true}}}if(!flag){val=this.get_value({ip_value:true});var list=this.get_list(val,function(list){this.render_list(list);this.show_dropdown()},this);this.arrow_el[val!=""?"addClass":"removeClass"]("cmbx_close");if(this.en_search_by){this.$el.find(".cmbx_search")[(val&&val!="")?"addClass":"removeClass"]("cmbx_detbtn")}}this.trigger_event("keyup",this,e,{})},show_info:function(info,data){var regex,format_str,m;this.$el.find(".cmbx_info").hide();if(!info&&data){info=this.info_format;regex=/{{([\w\d\s]+)}}/g;do{m=regex.exec(this.info_format);if(m){info=info.replace(m[0],data[m[1]])}}while(m)}if(info!=null&&info!=""){this.$el.append('<span class="cmbx_info">'+info+"</span>")}},li_clicked:function(e){var el;el=$(e.target);this.item_selected(el.prop("tagName")=="SPAN"?el:el.closest("li").find("SPAN"),e)},item_selected:function(item,e){var index,self,index,sel_data,list;self=this;if(e.type=="click"&&self.setnull_timer){clearTimeout(self.setnull_timer);self.setnull_timer=null}else{self.setnull_timer=setTimeout(function(){self.setnull_timer=null},250)}if(!item.hasClass("cmbx_btn")){self.input_el.val(item.text());list=this.parse(this.data);index=item.closest("li").index();self.selected_value=list[index][self.value_sel];self.$el.addClass("filled");if(e.type=="keydown"){self.hide_dropdown()}self.input_el.focus();clearTimeout(self.timer);self._disable_dd=false;self.arrow_el.addClass("cmbx_close");if(this.en_search_by){this.$el.find(".cmbx_search").addClass("cmbx_detbtn")}if(e.type=="click"){e.target=self.input_el[0]}if(self.auto_show_info){self.show_info(null,list[index])}self.trigger_event("item_selected",self,e,{index:index})}else{clearTimeout(self.timer);self._disable_dd=false;if(e.type=="click"){e.target=self.input_el[0]}e.stopPropagation();self.trigger_event(item.hasClass("cmbx_newbtn")?"add_new_clicked":"eol_clicked",self,e);if(e.type=="keydown"){self.hide_dropdown()}}},reset:function(){this.set_value("");this.data=null;this.trigger_event("keyup",this,{keyCode:0},{});if(this.auto_show_info){this.show_info(null,null)}},arrow_click:function(e){var list,el;el=$(e.target);if(el.hasClass("cmbx_close")){this.reset();el.removeClass("cmbx_close");if(this.en_search_by){el=this.$el.find(".cmbx_search");el.removeClass(".cmbx_detbtn")}this.input_el.focus()}else{list=this.get_list(this.get_value({ip_value:true}),function(list){this.input_el.focus();this.render_list(list);this.show_dropdown()},this)}},search_click:function(e){var el,self;self=this;el=$(e.target);if(!el.hasClass("cmbx_detbtn")){schema=get_obj(self.en_search_by);app.DS.search_popup.show({method:"set",flex_schema:schema,root_url:self.root_url,srch_def_args:self.srch_def_args,comp:self})}else{self.trigger_event("det_btn_clicked",self,e)}}});ComboBoxView.prototype.register("combobox","ComboBox",ComboBoxView);ComboBoxView.li_height=null;var DateFieldView=InputComponent.extend({events:{"keyup input":"keyup","keydown input":"keydown"},template_el:"#template_ip_dtpck",ip_el_selector:"input",initialize:function(options,defaults){_.extend(this,_.pick(options.options,["dateinput"]));this.init_component(options,"datefield")},_set_value:function(value,options){var date_fmt;date_fmt=options&&this.dateinput&&options.date_fmt=="DMY"?"DMY":"YMD";if(_.isDate(value)){value=value.toString(this.dateinput?date_fmt:null)}this.input_el.val(this.dateinput&&value!=""?Date.fromString(value,date_fmt).toString("YMD"):value);this.trigger_event("value_set",this,null)},get_value:function(){var val;val=this.input_el.val();if(this.dateinput){return val!=""?Date.fromString(val,"YMD").toString():val}else{return val}},get_date:function(){return Date.fromString(this.input_el.val(),this.dateinput?"YMD":null)},keyup:function(e){if(e.shiftKey&&(e.keyCode==40||e.keyCode==38)){dt=parse_date(this.get_value());if(dt){if(e.keyCode==38){this.set_value(dt.addDays(-1).toString())}else{this.set_value(dt.addDays(1).toString())}}}this.trigger_event("keyup",this,e)},keydown:function(e){this.trigger_event("keydown",this,e)}});DateFieldView.prototype.register("datefield","DateField",DateFieldView);var RadioGroupView=InputComponent.extend({template_el:"#template_ip_radgrp",ip_el_selector:"input",events:{"click input":"value_changed"},initialize:function(options,defaults){this.init_component(options,"radiogroup")},value_changed:function(e){this.trigger_event("changed",this,e,{value:this.get_value()})},_set_value:function(value){if(value!=""){this.$el.find("input[value="+value+"]").prop("checked",true)}else{this.$el.find("input").prop("checked",false)}},get_value:function(){return this.$el.find("input:checked").val()||""}});RadioGroupView.prototype.register("radiogroup","RadioGroup",RadioGroupView);var SelectBoxView=InputComponent.extend({template_el:"#template_ip_select",ip_el_selector:"select",events:{change:"value_changed","keyup select":"keyup"},initialize:function(options,defaults){var tmp,opts,key,tmp2,self;self=this;_.extend(self,{list_selector:"items"},_.pick(options.options,["parse","options2","list_selector","label_sel","value_sel","url"]));opts=options.options.options;if(opts&&!_.isArray(opts)){tmp=[];for(key in opts){tmp2={};tmp2[key]=opts[key];tmp.push(tmp2)}options.options.options=tmp}self.options=tmp;self.init_component(options,"selectbox");if(self.url){self.set_options_from_url(self.url)}},value_changed:function(e){if(this.$el.hasClass("error")){this.$el.removeClass("error");this.$el.find(".error_msg").remove()}this.trigger_event("changed",this,e,{value:this.get_value()})},_set_value:function(value,is_trigger){if(value!=null){var val=value.toString();if(val==""){val=this._renderdata.default_option||""}this.input_el.val(val);if(is_trigger){this.value_changed()}}},get_value:function(){return this.input_el.find(":selected").val()},set_options:function(options){var i,len,info,self;self=this;opts=options;if(opts&&!_.isArray(opts)){tmp=[];for(key in opts){tmp2={};tmp2[key]=opts[key];tmp.push(tmp2)}options=tmp}self._renderdata.options=options;self.render();return self},get_selected_data:function(){var value,list;value=this.get_value();list=this.parse(this.data);for(i=0;i<list.length;i++){if(list[i][this.value_sel]==value){return list[i]}}return null},parse:function(response){var list,list_selector,flag;list=response;list_selector=this.list_selector;flag=false;if(list_selector&&list_selector!=""&&response[list_selector]){list=response[list_selector];flag=true}if(response.cols){list=_.map(list,function(itm){return _.object(response.cols,itm)})}if(flag){response[list_selector]=list}return list},set_options_from_url:function(url){model=new Backbone.Model;model.url=url;this.set_options_from_model(model);return this},keyup:function(e){this.trigger_event("keyup",this,e)},set_options_from_model:function(m,callback){var self,tmp;self=this;m.fetch({success:function(model,response){self.$el.find(".error_msg").remove();self.data=response;var options=[],i;list=self.parse(response);if(self.label_sel&&self.value_sel){for(i=0;i<list.length;i++){tmp={};tmp[list[i][self.value_sel]]=list[i][self.label_sel];options.push(tmp)}}else{options=list}self._renderdata.options=options;self.render();self.trigger_event("options_loaded",self,null,{options:options});if(callback){callback(self)}},error:function(model,error){self.render_error("Retriving list failed")}})}});SelectBoxView.prototype.register("selectbox","SelectBox",SelectBoxView);var HiddenIPView=InputComponent.extend({template_el:"#template_ip_hiddenfield",ip_el_selector:"input",initialize:function(options,defaults){this.init_component(options,"hidden_input")},_set_value:function(value){this.input_el.val(value)},get_value:function(){return this.input_el.val()}});HiddenIPView.prototype.register("hidden_input","HiddenInput",HiddenIPView);var LabelIPView=InputComponent.extend({template_el:"#template_ip_labelfield",ip_el_selector:"span",initialize:function(options,defaults){this.init_component(options,"labelbox")},_set_value:function(value){this.input_el.text(value)},get_value:function(){return this.input_el.text()}});LabelIPView.prototype.register("labelbox","LabelBox",LabelIPView);var CheckBoxView=InputComponent.extend({template_el:"#template_ip_checkbox",ip_el_selector:"input",events:{"click input":"click_handler"},initialize:function(options,defaults){_.extend(this,_.pick(options.options,["default_value"]));this.init_component(options,"checkbox")},click_handler:function(e){this.trigger_event("clicked",this,e)},reset:function(){this.set_value(this.default_value||"")},_set_value:function(value){var is_chk=value!=""?true:false;this.input_el.prop("checked",is_chk)},get_value:function(){return this.input_el.is(":checked")?this.input_el.val():""}});CheckBoxView.prototype.register("checkbox","CheckBox",CheckBoxView);var TextAreaView=InputComponent.extend({template_el:"#template_ip_textarea",ip_el_selector:"textarea",initialize:function(options,defaults){this.init_component(options,"textarea")},_set_value:function(value){this.input_el.val(value)},get_value:function(){return this.input_el.val()},reset:function(){this.input_el.val("")},format_text:function(op,op_btn){var el,sel_start,sel_end;el=this.$el.find("textarea")[0];sel_start=el.selectionStart;sel_end=el.selectionEnd;if(sel_end>sel_start){text=el.value;if(!op){tmp=op_btn.$el[0].className;map={_b_btn:"b",_i_btn:"i",_u_btn:"u"};for(key in map){if(tmp.indexOf(key)!=-1){op=map[key]}}}if(op){el.value=text.substring(0,sel_start)+"["+op+"]"+text.substring(sel_start,sel_end)+"[/"+op+"]"+text.substring(sel_end)}}else{app.notifications.add("Info","Please select some text","info")}}});TextAreaView.prototype.register("textarea","TextArea",TextAreaView);var FileFieldView=InputComponent.extend({template_el:"#template_ip_filefield",ip_el_selector:".filetxt_ip",events:{"change .file_ip":"value_changed","click .file_ip_upbtn":"btn_clicked"},initialize:function(options,defaults){_.extend(this,_.pick(options.options,["manual_handle","ret_files"]));this.init_component(options,"filefield")},_set_value:function(value){this.input_el.val(value);if(value!=""&&value!=undefined){this.$el.find(".file_ip_upbtn").addClass("fb_close")}},value_changed:function(e){var el,self;self=this;el=e.target;self.$el.find(".filetxt_ip").val(el.files[0].name);if(!self.manual_handle){self.$el.find(".file_ip_upbtn").addClass("fb_close")}self.trigger_event("file_changed",self,null,{files:el.files})},btn_clicked:function(e){var el,self;self=this;el=$(e.target);if(el.hasClass("fb_close")){self.trigger_event("file_changed",self,null,{files:null});if(!self.manual_handle){el.removeClass("fb_close")}}else{self.$el.find(".file_ip")[0].click()}},get_value:function(){return this.ret_files?this.$el.find(".file_ip")[0].files[0]:this.input_el.val()}});FileFieldView.prototype.register("filefield","FileField",FileFieldView);var ImageFieldView=InputComponent.extend({template_el:"#template_ip_imagefield",ip_el_selector:"img",initialize:function(options,defaults){this.init_component(options,"imagefield");this.no_focus=true},_set_value:function(value){this.input_el.attr("src",value)},get_value:function(){return this.input_el.attr("src")}});ImageFieldView.prototype.register("imagefield","ImageField",ImageFieldView)})();(function(){var a=app.ComponentSet=Backbone.View.extend({element_template:_.template('<<%=tagName%> <%=typeof(className)!=="undefined"?"class=\'"+className+"\'":""%>><%=typeof(innerHTML)!=="undefined" ? innerHTML:""%></<%=tagName%>>'),initialize:function(c){this.components={};_.extend(this,_.pick(c,["components"]))},_renderComponents:function(c,e){var d;_.each(e,function(h,g){if(g.charAt(0)=="_"){d=$(this.element_template(h))}else{h.name=g;var f=new app.component_types[h.type].view({options:h});d=f.$el;this.components[g]=f}if("components" in h){this._renderInputs(d,h.components)}if(!h.append_to){c.append(d)}else{c.find(h.append_to).append(d)}},this)},renderComponents:function(d,e){var c;if(!e){e=this.$el}if(!d){d=this.components}if(typeof(e)=="string"){c=this.$el.find(e)}else{if(typeof(e)=="object"){c=e}}this._renderInputs(c,d)},append:function(e,d){var c=this.$el;c.append(el)}});var b=app.Form=Backbone.View.extend({events:{submit:"form_submitted",keydown:"keydown",click:"clicked"},initialize:function(c){this.components={};this.is_rendered=false;_.extend(this,_.pick(c,["validation","default_attr","fields","noPrevent","order_items"]));if(!("el" in c)){var d=this.outer_template({class_name:c.class_name||"",no_submit_btn:c.no_submit_btn});this.undelegateEvents();this.setElement($(d));if(c.appendTo){$(c.appendTo).append(this.$el)}this.delegateEvents()}},dlg_handler:function(d,c,f){if(!(d=="keydown"&&f&&f.keyCode==13)){this.trigger.apply(this,arguments)}},keydown:function(g){var f=$(g.target),c,d;d=f.prop("name");if(d&&g.keyCode==13){c=this.components[d];this.trigger("keydown",c,g,null)}}});_.extend(b.prototype,{default_attr:{},components:{},validation:{},element_template:_.template('<<%=tagName%> <%=typeof(className)!=="undefined"?"class=\'"+className+"\'":""%> <%if(typeof(attrs) !="undefined"){ _.each(attrs,function(value,attr){%> <%=attr%>= <%=value%> <%});}%> ><%=typeof(innerHTML)!=="undefined" ? innerHTML:""%></<%=tagName%>>'),outer_template:_.template("<form class='<%=class_name%>' autocomplete='off' novalidate><div class='fields'></div><div class='form_errors hlb_messages'></div><% if(!no_submit_btn){%><button type='submit' style='display:none'></button><%}%></form>"),form_submitted:function(c){if(!this.noPrevent){c.preventDefault()}this.trigger("form_submit",c)},_renderInputs:function(d,c,e){var f;_.each(c,function(h,g){if(h&&!h.name){h.name=g}});if(this.order_items){c=_.sortBy(c,function(g){return g?g.index:0})}_.each(c,function(h){if(h==null){return}if(h.name.charAt(0)=="_"){f=$(this.element_template(h))}else{h.defaults=h.defaults||e.default_attr;var g=new app.component_types[h.type].view({options:h,scope:this});f=g.$el;this.components[h.name]=g}if("fields" in h){if(h.default_attr){e.default_attr=h.default_attr}this._renderInputs(f,h.fields,e)}if(!h.append_to){d.append(f)}else{if(typeof h.append_to=="string"){d.find(h.append_to).append(f)}else{h.append_to.append(f)}}},this)},get_next:function(g){var f,j,h,e,d,c;f=this;j=Object.keys(f.components);g=g||j[0];if(typeof g=="object"){g=g.name}for(h=j.indexOf(g)+1,c=j.length;h<c;h++){e=f.components[j[h]];if(e&&e.$el.is(":visible")&&!e.disabled){d=e;break}}if(!d){return false}return d},focus:function(c,e){var k,j,d,f,h,l,g;k=this;j=Object.keys(k.components);f=c||j[0];if(typeof f=="object"){f=f.name}if(e=="next"||!c){for(d=(!c?0:j.indexOf(f)+1),g=j.length;d<g;d++){h=k.components[j[d]];if(h&&h.$el.is(":visible")&&!h.no_focus&&!h.disabled){l=h.name;break}}if(!l){return false}}else{l=f}setTimeout(function(){k.components[l].input_el.focus()},20);return true},renderInputs:function(d,e){var c;if(!e){e=".fields"}if(!d){d=this.fields}if(typeof(e)=="string"){c=this.$el.find(e)}else{if(typeof(e)=="object"){c=e}}this._renderInputs(c,d,{default_attr:this.default_attr});this.is_rendered=true},focus_comp:function(c){this.components[c].focus()},hide_comps:function(d){var c;for(c in d){if(d[c]){this.components[d[c]].hide()}}return this},show_comps:function(d){var c;for(c in d){if(d[c]){this.components[d[c]].show()}}return this},parseInputs:function(e){if(!e){e={}}var d=this.$el.find(".component");var c=this;$.each(d,function(h,g){var g=$(g);var j=g.data("comp-type");var f=g.find("input").attr("name");var l;if(!f){console.log("Invalid Component name");return}if(!app.component_types[j]){console.log("Invalid Component type");return}if(e[f]){l=e[f]}else{l={type:j,name:f}}var k=new app.component_types[j].view({ip_options:l,ip_defaults:this.default_attr,el:g});c.components[f]=k})},append:function(e,d){var c=this.$el.find(".fields");c.append(el)},release:function(){var c;this.$el.find(".fields").html("");for(c in this.components){this.components[c].release()}this.components={}},validation_conditions:["required","pattern","equalTo","minlength","maxlength","type","greater_than","less_than","fn"],error_messages:{required_true:"This field is required",pattern_email:"Enter a valid email address",pattern_date:"Invalid Date",type_number:"Invalid Number"},error_template:_.template('<span class="cmp_msg error_msg" generated="true"><%= error %></span>'),get_comp_val:function(c){return this.components[c].get_value()},get_values:function(g,l,m){var j,e,k,h,c,f,d;k=this;j={};f=this.components;if(!this.el){return false}c=l?l:Object.keys(f);for(e=0;e<c.length;e++){h=c[e];if(h&&!f[h].skipped){d=f[h].get_value(m);if(!g||(g&&d!="")){j[h]=d}}}if(k.extra_values){_.extend(j,k.extra_values)}return j},set_values:function(d,f){var c,e,g;c=this;g=c.components;c.trigger("before_set_values",null,null,d);for(e in g){if(e in d){g[e].set_value(d[e],f)}}c.trigger("values_set");return c},reset:function(c,f){var e,g,d;d=this;if(c){g=_.pick(d.components,c)}else{g=d.components}if(f){g=_.omit(g,f)}d.renderErrors();for(e in g){g[e].render_error(null);g[e].reset()}d.extra_values=null;d.trigger("reset");return d},disable:function(e){var c,d;d=this.components;e=e||Object.keys(d);for(c in e){d[e[c]].disable()}return this},enable:function(f){var d,e,c;e=this.components;f=f||Object.keys(e);for(d in f){c=e[f[d]];if(!c.always_disable){c.enable()}}return this},fill_model:function(c){var d=_.mapObject(this.fields,function(f,e){return f.val});c.set(d,{silent:true})},validateObj_list:function(d){var e,c=[],f;for(e in d){f=this.validate(e);if(f){c.push(f)}}return c},validate:function(t,v){var y,f,g,n,u,m,l,q,e,c,s,d,r,j,k;n=this;g={};if(t){u={};u[t.name]=t;m=u}else{m=n.components}l=n.validation;for(f in m){if(f in l){if(typeof(arg_values)==="undefined"){d=m[f].get_value()}else{d=arg_values[f]}}else{continue}s=l[f];r=[];if(s.constructor===Array){r=s}else{if(s!==null&&typeof s==="object"){r=[s]}}for(q=0;q<r.length;q++){e=false;c=false;for(k in r[q]){if(this.validation_conditions.indexOf(k)<=-1){continue}var p;j=r[q][k];if(k!="fn"&&_.isFunction(j)){j=j(m,f,this)}switch(k){case"required":if(j==true){if(d==""){e=true}}else{if(j==false&&d==""){c=true}}break;case"pattern":switch(j){case"email":p=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;if(!p.test(d)){e=true}break;case"date":p=/^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/;if(!p.test(d)){e=true}break}break;case"equalTo":if(j in m){if(d!=m[j].get_value()){e=true}}break;case"minlength":if(d.length<j){e=true}break;case"maxlength":if(d.length>j){e=true}break;case"greater_than":if(!(d>j)){e=true}break;case"less_than":if(!(d<j)){e=true}break;case"type":if(j=="number"){if(isNaN(d)){e=true}else{var h=parseFloat(d);if(h==NaN){e=true}}}break;case"fn":if(j(d,this)){e=true}break}if(e){var w={reason:k};if(r[q].hasOwnProperty("msg")){w.msg=r[q].msg}else{var o=k+"_"+j;if(o in this.error_messages){w.msg=this.error_messages[o]}else{w.msg="An error in input"}}g[f]=w;break}if(c){break}}if(f in g){break}}}if(t){g=g[t.name]}if(v&&t&&t.type=="datefield"&&_.isEmpty(g)){t.set_value(Date.fromString(t.get_value()).toString())}return _.isEmpty(g)?null:g},renderServerErrors:function(c,d){var f={},e;if(d){e=d}else{if(c){if(c.responseJSON&&c.responseJSON.errors){e=c.responseJSON.errors}else{e={__all__:"Unable to process right now, please try later"}}}}if(e){_.each(e,function(h,g){f[g]={msg:h}})}else{f=undefined}return this.renderErrors(f)},renderError_single:function(d,c){if(typeof c.msg=="string"){d.append($(this.error_template({error:c.msg})))}else{if(typeof c.msg=="object"){_.each(c.msg,function(f,e){d.append($(this.error_template({error:f})))},this)}}},renderErrors:function(g,f){var c,d,e;components=this.components;if(typeof g==="undefined"){g={}}this.$el.find(".error_msg").remove();for(e in components){c=components[e].$el;if(c.length==0){continue}if(_.has(g,e)){this.renderError_single(c,g[e]);c.addClass("error")}else{c.removeClass("error")}}if(f){components[_.find(_.keys(g),function(h){return h!="__all__"})].focus()}if(g!=null&&"__all__" in g){this.renderError_single(this.$el.find(".form_errors"),g.__all__)}}});window.get_error_obj=function(c){if(c.responseJSON&&c.responseJSON.errors){return c.responseJSON.errors}return null}})();app.Tab=Backbone.View.extend({last_tab_id:0,initialize:function(b){var c=true,a;a=this;if(!b||!("el" in b)){a.$el.addClass("tab_content_item")}a.$el.addClass(a.class_name||"");if(a.beforeInit){c=a.beforeInit(b)}if(c){_.extend(a,{id:"tabid_"+a.last_tab_id},_.pick(b,["label","id","tab_id","init","no_append"]));a.last_tab_id++}if(a.afterInit){c=a.afterInit(b)}},render_error:function(b){var a;a=this;a.$head_el.find(".error").remove();if(b){a.$head_el.append($('<span class="error">'+b+"</div>"))}},hide:function(){this.$head_el.addClass("hidden").hide()},show:function(){this.$head_el.removeClass("hidden").show()}});app.Tabs=Backbone.View.extend({events:{"click .tab_head li":"tab_headitem_clicked"},pass_through:true,current_tab:"",initialize:function(a){this.tabs={};_.extend(this,_.pick(a,["tabs","tab_id","$scope"]));if(!a||!("el" in a)){var b=this.template({type:"outer",class_name:this.id});this.setElement($(b));$(a.appendTo).append(this.$el)}else{}},children:function(){return this.tabs[this.current_tab].children},append:function(d){var c,e,g=true,f=false,b;b=this;if(!Array.isArray(d)){d=[d]}if(_.isEmpty(this.tabs)){g=true}for(c=0;c<d.length;c++){e=d[c];if(!e){continue}if(e.tab_id in b.tabs){continue}f=true;e.$scope=b.$scope;b.tabs[e.tab_id]=e;var a=b.template({type:"tab_head",id:e.tab_id,label:e.label});e.$head_el=$(a);b.$el.find(">.tab_head").append(e.$head_el);if(!e.no_append){e.$el.hide();this.$el.find(">.tab_content").append(e.$el)}if(e.afterAppend){e.afterAppend()}}},init:function(){var a=this.$el.find(".tab_head>li.active");if(!a.length){a=this.$el.find(".tab_head>li:first")}this.show_tab(a.data("id"));return this},trigger_event:function(){},render_errors:function(c){var b,a;a=this;for(b in c){a.$head_el.remove(".error");if(c[b]){a.$head_el.append($('<span class="error">'+c[b]+"</div>"))}}},show_tab:function(a,c){var f;if(!a&&c&&c.index!=undefined){a=_.filter(_.map(this.tabs,function(h,g){return h.$head_el.hasClass("hidden")?null:g}),function(g){return g!=null})[c.index]}var e=this.$el.find(".tab_head>li"),d,b=this.$el.find(".tab_content>div");if(this.current_tab){f=this.tabs[this.current_tab];if(f.onhide){f.onhide()}}for(d=0;d<e.length;d++){if($(e[d]).data("id")==a){e.removeClass("active").eq(d).addClass("active");b.hide();b.eq(d).show();this.current_tab=a;break}}if(a in this.tabs){c=c||{};this.trigger("tab_show",a,c,this.tabs[a]);if(this.tabs[a].onshow){this.tabs[a].onshow(c)}this.trigger("after_tab_show",a,c,this.tabs[a])}},dsbl_tabs:function(a){var b;a=a||_.keys(this.tabs);for(b=0;b<a.length;b++){this.tabs[a[b]].hide()}},enbl_tabs:function(a){var b;a=a||_.keys(this.tabs);for(b=0;b<a.length;b++){this.tabs[a[b]].show()}},get_current_tab:function(){return this.tabs[this.current_tab]},get_tab:function(a){return this.tabs[Object.keys(this.tabs)[a]]},tab_headitem_clicked:function(b){var a;a=$(b.target).data("id");this.tabs[a].render_error();this.show_tab(a)}});app.Tabs.prototype.template=_.template($("#tabs_template").html());app.Popup=Backbone.View.extend({head_map:{create:["Create","Creating"],update:["Edit","Updating"],set:["",""]},btn_map:{set:["OK","OK"],create:["Save & Close","Saving"],update:["Save & Close","Saving"]},save_btn_map:{set:["OK","OK"],create:["Save","Saving"],update:["Save","Saving"]},initialize:function(b){var a=this;if(!(this.beforeInit?this.beforeInit(b):true)){return}if(!b||!("el" in b)){var c=this.template({id:this.id,class_name:this.class_name||"",head:typeof(this.head)=="function"?this.head():this.head,buttons:this.buttons||"",inst:this});this.setElement($(c));if(b&&b.appendTo){$(b.appendTo).append(this.$el)}this.$el.on("click",".mfp-close",function(){if(!a.no_close_btn){a.close()}})}this.$el.data("view",this);this.on("popup:open",this.onshow);this.afterInit?this.afterInit(b):true},onshow:function(){},trigger_event:function(){},_gl_ev_handler:function(a,b){if(a=="keydown"&&b.keyCode==75&&b.altKey){this.submit_form(b)}},gl_ev_handler:function(a,b){return this._gl_ev_handler(a,b)},_render:function(){var a=this;this.render(this.is_rendered);if(!this.is_rendered){this.$el.on("keydown",function(b){if(b.ctrlKey&&b.keyCode==27){a.close()}});this.is_rendered=true}},toogleButton:function(a){this.$el.find(".op_btn")[a?"removeClass":"addClass"]("disabled")},set_head:function(a){this.$el.find(".popup_head").html(a||(typeof(this.head)=="function"?this.head(this.options):this.head))},setMode:function(b,a){var c;if(a&&a.method){c=a.method}else{c=this.options.method}if(c=="create"&&b=="idle"&&this.show_save_n_next&&!this.options.hide_cont_btn){this.$el.find(".op_btn_snnx").show()}else{this.$el.find(".op_btn_snnx").hide()}if(c in this.head_map){this.$el.find(".popup_head").html(this.head_map[c][b=="working"?1:0]+" "+(typeof(this.head)=="function"?this.head(this.options):this.head))}if(this.btn_map&&c in this.btn_map){this.$el.find(".op_btn_sncl").text(this.btn_map[c][b=="working"?1:0])}if(this.save_btn_map&&c in this.save_btn_map){this.$el.find(".op_btn_save").text(this.save_btn_map[c][b=="working"?1:0])}if(this.form){this.form[b=="working"?"disable":"enable"]()}this.$el.find(".op_btn")[b=="working"?"addClass":"removeClass"]("disabled")},focus_handler:function(d){var c,b,a,f;c=app.Popup.prototype.opened_popups[app.Popup.prototype.opened_popups.length-1];b=c.$el.closest(".mfp-wrap");if(d.target!==b[0]&&!$.contains(b[0],d.target)){a=b.find("input:visible:enabled,textarea:visible:enabled,button:visible");if(!a.length){a=b.find(".mfp-content")}if(a.length>1){f=a.filter(":not(button:visible)");if(f.length){f=f.eq(0)}}if(!f){f=a.eq(0)}f.focus()}},center:function(){var d,a,c,b;a=this;d=a.$el.closest(".mfp-wrap");c=(d.outerHeight()-a.$el.outerHeight())/2;if(c<0){c=0}a.$el.css({top:c+"px",left:(d.outerWidth()-a.$el.outerWidth())/2+"px"});a.height=a.$el.outerHeight()},show:function(b){var a=this;this.options=b;this._render();this.parent=this.el.parentNode;if(this.parent){this.parent.removeChild(this.el)}this.$el.removeClass("mfp-hide");this.resize_observer=new MutationObserver(function(){});this.resize_observer.observe(this.el,{attributes:true});if(this.opened_popups.length==0){$(document.body).css({"overflow-y":"hidden"});$(document.body).on("focusin",this.focus_handler)}var c=$('<div class="mfp-bg '+(this.disable_anim?"":"mfp-3d-unfold")+'"></div><div class="mfp-wrap'+(this.disable_anim?"":" mfp-3d-unfold")+(this.wrap_class?" "+this.wrap_class:"")+'" tabindex="-1" style="overflow-x: hidden; overflow-y: auto;"><div class="mfp-container mfp-s-ready mfp-inline-holder"><div class="mfp-content"></div></div></div>').prependTo("body");c.css({zIndex:1099+this.opened_popups.length});c.find(".mfp-content")[0].appendChild(this.el);this.opened_popups.push(this);this._lastFocusedEl=document.activeElement;setTimeout(function(){var d,e;c.addClass("mfp-ready");if(a.center_on_init!=false){a.center()}a.trigger("after_show");if(a.afterShow){a.afterShow(b)}if(!a.no_autofocus){a.focus_popup()}},100)},focus_popup:function(){var b,d,c,a;a=this;c=a.$el.closest(".mfp-wrap");b=c.find("input:visible:enabled,textarea:visible:enabled,button:visible");if(b.length>1&&b.filter(":not(button:visible)").length){d=b.filter(":not(button:visible)");if(d.length>0){d=d.eq(0)}}if(!d){d=b.eq(0)}d.focus()},close:function(a){var f,e,b,d,g;if(!this.$el.hasClass("mfp-hide")){if(this.onclose){this.onclose()}f=this.el.parentNode;e=$(f).closest(".mfp-wrap");d=e.prev();e.removeClass("mfp-ready");d.removeClass("mfp-ready");if(this.opened_popups.length<=1){$(document.body).removeAttr("style");$(document.body).off("focusin",this.focus_handler)}b=this;b.resize_observer.disconnect();b.resize_observer=null;var c=function(){b.$el.addClass("mfp-hide");f.removeChild(b.el);e.detach();d.detach();if(b.parent){b.parent.appendChild(b.el)}b.opened_popups.pop();if(!b.manual_focus&&b._lastFocusedEl){b._lastFocusedEl.focus()}if(b.after_close&&!a){b.after_close()}};if(this.removalDelay==0){c()}else{setTimeout(c,this.removalDelay||300)}}},post_submit:function(b,f){var d,c,a;d=this.options;a=this;c=new (d.model||this.model);c.set(b);if(d.method=="update"){c.set("id",d.data.id)}if(!this.no_set_mode){this.setMode("working")}if(this.before_request){this.before_request(c)}c.sync(d.method=="update"?"update":"create",c,{success:function(e){var g;if(!a.no_set_mode){a.setMode("idle")}if(a.after_request){a.after_request(e,"success",b,f)}if(!a.dont_show_notif){app.notifications.add(e.head,e.msg,"success")}g=d.handle_snnx!=undefined?d.handle_snnx:a.handle_snnx;if(g&&((!$(f.target).hasClass("btn")&&!d.hide_cont_btn&&d.method=="create")||$(f.target).hasClass("op_btn_snnx"))){a.render(true,true);if(a.form){a.form.focus()}}else{if(!a.no_close_after_submit&&!$(f.target).hasClass("op_btn_save")&&!$(f.target).hasClass("op_btn_snnx")){a.close()}}if(d.callback){d.callback.call(d.invoker||this,"save_success",e,b)}if(d.invoker){d.invoker.trigger("popup_event","save_success",e)}},error:function(e){if(!a.no_set_mode){a.setMode("idle")}if(a.after_request){if(a.after_request(e,"error")==false){return}}if(a.form){a.form.renderServerErrors(e)}}})},submit_form:function(g){var d,f,b,h,c,a;a=this;d=this.options;g.preventDefault();if(a.form){f=a.form;b=f.get_values();h=d.method!="update"?f.validate():undefined;f.renderErrors(h)}else{b={}}if(this.after_get_values){retval=this.after_get_values(b,g);if(retval==false){return}}if(!h){this.post_submit(b,g)}}});app.Popup.prototype.opened_popups=[];app.Popup.prototype.template=_.template($("#popup_template").html());app.IPS=Backbone.View.extend({events:function(){var a;a={"keyup .ips_container input":"key_up","keydown .ips_container input,.ips_container select":"key_down","contextmenu .tl_li":"oncontextmenu"};if(this.en_click_event){a.click="click_handler";a.dblclick="click_handler"}return a},ip_defaults:{class_name:"_lg _type2"},initialize:function(a){this.rows=[];this.__rid=0;_.extend(this,_.pick(a,["ips_id","class_name","en_click_event","is_scrollable","head","ip_defaults","extra_value_keys","schema","rows","validation"]));if(this.schema){this.schema=_.pick(this.schema,function(d,c){return d!=null})}if(!a||!("el" in a)){var b=this.outer_template({id:this.ips_id,class_name:this.class_name||"",head:this.head});this.setElement($(b));if(a.appendTo){$(a.appendTo).append(this.$el)}if(a.insertButton){this.$el.append($("<div><a class='component btn _md _type1 _theme1 _ipsheet_add_new_btn'>Add New Item</a><div>"))}}if(this.after_init){return this.after_init(a)}},render:function(){this.delegateEvents();var g,f=0,b=0,h,d,c,e,a,i;i=this;e={};for(g in i.schema){a=i.schema[g];e[a.name||g]=a}this.schema=e;for(g in this.schema){f+=this.schema[g].width;this.schema[g]["key"]=g}this.sorted_keys=_.sortBy(Object.keys(this.schema),function(j){return this.schema[j].index},this);d=this.sorted_keys[0];for(g in this.schema){if(g==d){continue}if(typeof(this.schema[g].width)=="string"){this.schema[g].style="width:"+this.schema[g].width}else{h=wacky_round(this.schema[g].width/f*100,2);b+=h;this.schema[g].style="width:"+h+"%"}}if(typeof(this.schema[d].width)!="string"){this.schema[d].style="width:"+(100-b)+"%"}else{this.schema[d].style="width:"+this.schema[d].width}c=this.template({ips_id:this.ips_id,schema:this.schema,sorted_keys:this.sorted_keys,rows:[],classes:"",is_scrollable:this.is_scrollable});this.$el.find(".ips_container")[0].innerHTML=c;this.trigger("rendered");this.is_rendered=true},hide:function(){this.$el.hide()},show:function(){this.$el.show()},release:function(b){var d,c,a;a=this;for(d=a.rows.length-1;d>=0;d--){a.deleteRow(d)}a.rows=[];if(!b){a.is_rendered=false;a.$el.find(".ips_container").html("")}else{a.$el.find(".table_list").css("height","auto")}},get_col_from_e:function(b,a){},insertRow:function(j,b,f,k){var g,a,n,h,m,e,c,l,d;g=this.row_template({ips_id:this.ips_id,schema:this.schema,sorted_keys:this.sorted_keys});c=$(g);l={el:c,cols:{},rid:this.__rid++};if(b==undefined){this.$el.find(".table_list").append(c)}else{this.$el.find(".table_list > li:eq("+(b)+")").before(c)}a=c.find("ul > li");for(e=0;e<a.length;e++){n=$(a[e]),column=n.data("key");m=this.schema[column];m.ip_options.defaults=this.ip_defaults;if(m.ip_options.dlgTo=="scope"){m.ip_options.dlgTo=this.delegatedHandler}h=new app.component_types[m.ip_options.type].view({options:m.ip_options,scope:this});if(column in j){h.set_value(j[column])}l.cols[column]={ip:h};n.html("");n.append(h.$el)}if(b==undefined){this.rows.push(l)}else{this.rows.splice(b,0,l)}if(f){l.data=f}l.extra_values=k||{};this.trigger("row_insert",b!=undefined?b:this.rows.length-1,"",null,null);return l},oncontextmenu:function(b){if(b.which==3){var a=$(b.target).closest(".tl_li");this.delegatedHandler1("context_menu",b);return false}},context_item_click:function(a,c,b){this.trigger("context_item_click",a,this,null,{value:c,data:b})},show_menu:function(f,b,d){var a,c;if(d.pageX){a={left:d.pageX,top:d.pageY}}else{c=$(d.target);a={left:c.position().left+(c.width()/2),top:c.offset().top}}if(d){app.last_pp_cls_prv_time=d.timeStamp}app.ContextMenu_ext.show(this,b,f,{position:a,callback:this.context_item_click});this.has_menu=true;app.opened_menu={context:this,onclose:function(){this.has_menu=false}}},deleteRow:function(b){var a;if(typeof(b)=="number"){a=b;b=this.rows[b]}else{a=this.getRowIndex(b)}for(col in b.cols){b.cols[col].ip.release()}b.el.remove();this.rows.splice(a,1);this.trigger("row_delete",a,"",null,null);return this},getRow:function(a){if(a<0){a=this.rows.length+a}return this.rows[a]},getRowIndex:function(b){var a;for(a in this.rows){if(b.rid==this.rows[a].rid){return a}}},isLast:function(a){if(typeof(a)=="number"){return a>=this.rows.length-1?true:false}else{if(typeof(a)=="object"){return this.rows.indexOf(a)==this.rows.length-1?true:false}}},nextRow:function(a){if(typeof(a)=="number"&&a<this.rows.length-1){return this.rows[a+1]}else{if(typeof(a)=="object"){return this.rows[this.rows.indexOf(a)+1]}}},prevRow:function(a){if(typeof(a)=="number"&&a<this.rows.length-1){return this.rows[a-1]}else{if(typeof(a)=="object"){return this.rows[this.rows.indexOf(a)-1]}}},disableRow:function(c,b){var a;b=b||_.keys(c.cols);for(a=0;a<b.length;a++){c.cols[b[a]].ip.disable()}return this},enableRow:function(c,b){var a;b=b||c.cols;for(a=0;a<b.length;a++){c.cols[b[a]].ip.enable()}return this},isRowEmpty:function(b,a,c){return _.every(this.get_values(b,a,c),function(d){return d==""||d==undefined})},lastCol:function(){cols=this.sorted_keys;return cols[cols.length-1]},lastRow:function(){return this.rows[this.rows.length-1]},nextCol:function(a){cols=this.sorted_keys;return cols[cols.indexOf(a)+1]},get_components:function(a){if(typeof(a)=="number"){a=this.rows[a]}var b={};for(col in a.cols){b[col]=a.cols[col].ip}return b},hide_comps:function(c,b){var a;if(typeof(c)=="number"){c=this.rows[c]}for(a in b){c.cols[b[a]].ip.hide(true)}},show_comps:function(c,b){var a;if(typeof(c)=="number"){c=this.rows[c]}for(a in b){c.cols[b[a]].ip.show(true)}},get_values:function(h,g,a,e){var b={},d,c,f;if(typeof(h)=="number"){h=this.rows[h]}g=g||Object.keys(h.cols);if(a){g=_.difference(g,a)}for(d in g){c=g[d];if(c){f=h.cols[c].ip.get_value();if(f||!e){b[c]=f}}}if(h.extra_values){_.extend(b,h.extra_values)}return b},get_value_list:function(e,f){var d,a,c,b;b=this;d=[];for(a in b.rows){c=b.get_values(b.rows[a],e);if(f){f(c,b.rows[a])}d.push(c)}return d},set_value_list:function(b,d,f){var e,c,a;a=this;a.release(true);for(c in b){a.insertRow(b[c],null,d,f?f[c]:null)}return a},set_values:function(e,a,d,f){var c,b;if(typeof(e)=="number"){e=this.rows[e]}d=d||_.keys(a);for(c in d){b=d[c];if(b){e.cols[b].ip.set_value(a[b])}}if(f){e.extra_values=f}return this},reset_row:function(d,a){var c,b;if(typeof(d)=="number"){d=this.rows[d]}select_cols=_.difference(Object.keys(d.cols),a);for(b in select_cols){d.cols[select_cols[b]].ip.set_value("")}d.extra_values={};d.data=null;this.trigger("row_reset",this.rows.indexOf(d));return d},focusRow:function(f,b){var e,d,a,c;if(typeof(f)=="number"){f=this.rows[f]}if(!b){d=this.sorted_keys;for(c=0,a=d.length;c<a;c++){e=f.cols[d[c]].ip;if(!e.disabled){b=d[c];break}}}e=f.cols[b].ip;e.input_el.focus();return this},getLastRow:function(){return this.rows[this.rows.length-1]},focusColumn:function(h,c,d,b,i){var a,e,g,f;if(d=="next"||d=="prev"){g=this.sorted_keys;e=g.indexOf(c);if(d=="next"){if(e+1>=g.length){return false}a=h.cols[g[e+1]]}else{if(e-1<0){return false}a=h.cols[g[e-1]]}}else{a=h.cols[c]}if((a.ip.disabled||a.ip.no_focus||a.ip.$el.is(":hidden")||a.ip.$el.css("visibility")==="hidden")&&b){return this.focusColumn(h,g[e+1],d,true,i)}else{a.ip.input_el.focus();if(i&&i.select&&a.ip.input_el[0].select){a.ip.input_el[0].select()}return true}},key_down:function(b){var a;if(b.keyCode==9){return this.delegatedHandler1("tabkey_press",b)}else{if(b.keyCode==13){return this.delegatedHandler1("enterkey_press",b)}}if(b.keyCode==38||b.keyCode==40){if(this.handleArrowKeys){a=this.getCellFromEl($(b.target));return this.ArrowKeyHandler(b,a)}else{return this.delegatedHandler1("arrow_press",b)}}return this.delegatedHandler1("key_down",b)},key_up:function(a){if(a.keyCode==9||a.keyCode==13){return}this.delegatedHandler1("text_changed",a)},click_handler:function(a){this._ips_event_handler("clicked",a,null)},ArrowKeyHandler:function(f,b){var a,c,d;c=b.row;d=b.column;if(f.keyCode==38&&c>0||f.keyCode==40&&c<this.rows.length-1){a=f.keyCode==38?c-1:c+1;this.rows[a].cols[d].ip.focus();if(a==0){this.scrollTo("top")}else{if(a=this.rows.length-1){this.scrollTo("bottom")}}}},getCellFromEl:function(b){var d,a,c;a=b.closest(".table_list_ul > li");c=a.data("key");d=a.closest(".table_list > li");return{row:d.index(),column:c}},delegatedHandler1:function(c,d,b){var a;cell=this.getCellFromEl($(d.target));a=this.rows[cell.row].cols[cell.column].ip;b=b||{};b.comp=a;if(!d){d={target:a.$el}}this.trigger(c,cell.row,cell.column,d,b)},delegatedHandler:function(c,a,d,b){b=b||{};b.comp=a;if(!d){d={target:a.$el}}this._ips_event_handler(c,d,b)},_ips_event_handler:function(f,h,b){var g,d,a,c;g=$(h.target).closest(".table_list_ul > li");d=g.data("key");a=$(h.target).closest(".table_list > li");c=a.index();this.trigger(f,c,d,h,b)},adj_size:function(){var b=0,a=this;a.$el.find(".table_list").children().each(function(){b+=$(this).outerHeight(true)});a.$el.find(".table_list").css("height",b+40)},renderErrors:function(d,f,j){var f,c,g,b,h,a,i,e;i=this;j=j||{};if(!f){if(!(d&&d.responseJSON&&d.responseJSON&&d.responseJSON.errors&&d.responseJSON.errors.item_errors)){return}f=d.responseJSON.errors.item_errors}for(c in f){h=f[c];i.rows[c].errors=h;for(b in h){e=h[b];if(_.isArray(e)){e=e[0]}if(b in this.schema){i.rows[c].cols[b].ip.render_error(e)}}}if(!_.isEmpty(f)){a=Number(Object.keys(f)[0]);g=this.rows[a].cols[Object.keys(f[a])[0]];i.adj_size()}if(j.focus_first&&g){g.ip.focus()}return g},scrollTo:function(a){var b;b=this.$el.find(".table_listcnt")[0];b.scrollTop=a=="bottom"?b.scrollHeight:0}});app.IPS.prototype.template=_.template($("#ips_template").html());app.IPS.prototype.outer_template=_.template($("#ipsheet_outer_template").html());app.IPS.prototype.row_template=_.template($("#ips_row_template").html());app.IPS_ext=app.IPS.extend({backspace_pressed:function(f,c,b,d){var a=this;if(!d||(d&&(!d.altKey||!d.shiftKey))){return false}if(f.cols[b].ip.type=="combobox"){f.cols[b].ip.hide_dropdown()}if(a.dlt_lock){return false}if(f.cols[b].ip.get_value()==""){if(f.dclick_flag==true){if(a.rows.length>1){a.deleteRow(f);a.dlt_lock=true;setTimeout(function(){a.rows[c!=0?c-1:0].cols[b].ip.focus()},400)}}else{if(true){a.reset_row(f)}f.dclick_flag=true;setTimeout(function(){f.dclick_flag=false},200);setTimeout(function(){a.dlt_lock=false},600)}}return true},get_total:function(){return _.reduce(this.rows,function(a,b){return a+Number(b.cols[this.total_col].ip.get_value())},0,this)},update_total:function(){this.$el.find(".total_sec").text(to_money(this.get_total()))},validate_rows:function(){var c,g,f,e,d,a,b;a=this;d=new app.Form({el:$("<div></div>"),validation:a.validation});d.vald_options=a.vald_options;if(a.pre_validate&&a.pre_validate(null,null,d,true)=="skip"){return true}b=a.rows.length-1;if(a.isRowEmpty(a.rows[b])){b--}for(c=0;c<=b;c++){f=a.rows[c];g=a.get_components(f);d.components=g;e=d.validate();d.renderErrors(e);if(e){a.adj_size();a.focusColumn(f,Object.keys(e)[0]);return false}}if(a.post_validate&&!a.post_validate(null,null,true)){return false}return true},validate_row:function(m,d,e){var c,i,l,k,g,h,j,f,a,b;l=this;a=new app.Form({el:l.$el});a.validation=l.validation||{};a.vald_options=l.vald_options;c=l.get_components(m);i=l.get_values(m);a.components=c;h=a.validate();if(!h&&l.pre_validate){h=l.pre_validate(m,i,a)}a.renderErrors(h);if(h){l.adj_size();l.focusColumn(m,Object.keys(h)[0]);return false}if(l.post_validate){b=l.post_validate(m,i,false);if(b!==true){return b}}l.after_validate(m,d,e);return true},after_validate:function(d,c,b){var a;a=this;if(a.isLast(d)&&c){next_row=a.insertRow(b||{})}else{next_row=a.nextRow(d)}if(c){setTimeout(function(){a.focusRow(next_row)},20)}}});app.ContextMenu_ext=new (Backbone.View.extend({template:_.template("<div class='cmbx_ul_cnt'><ul class='cmbx_ul'><%_.each(items,function(option){if(option){ %><li title='<%=option.label%>' data-val='<%=option.value%>'><span><%=option.label%></span><%if(info_enabled){%><i><%=option.info%></i><%}%></li><%}})%></ul></div>"),initialize:function(a){},show:function(a,c,f,d){var b,e;b=this;e=$("#global_dropdown_container");d=d||{};_.defaults(d,{position:{top:"30%",left:"30%"},width:200,info_enabled:false});_.extend(b,{view:a,id:f,options:d,callback:d.callback});e.html(this.template({items:c,info_enabled:d.info_enabled})).off("click").on("click",function(g){b.li_clicked(g)}).css({top:d.position.top,left:d.position.left,width:d.width}).show();app.opened_dropdown=e;app.focus_handler.current_focused_comp=this},li_clicked:function(c){var a=this,b,d;b=this.options;if(app.opened_dropdown){app.opened_dropdown.hide();app.opened_dropdown=null}d=$(c.target).closest("li");if(a.callback){a.callback.call(a.view,a.id,d.data("val"),b.data)}else{a.view.trigger("context_item_click",a.id,d.data("val"),b.data)}},gl_ev_handler:function(c,g){var f,d,a,b;b=$("#global_dropdown_container");if(c=="keypress"&&_.in_list(g.keyCode,[38,40])){f=b.find(".cmbx_ul > li");d=f.filter(".selected");if(g.keyCode==40){a=d.is(":last-child")||d.length==0?(f.first()):d.next()}else{a=d.is(":first-child")||d.length==0?(f.last()):d.prev()}d.removeClass("selected");a.addClass("selected")}else{if(c=="keypress"&&g.keyCode==13){g.target=b.find(".cmbx_ul > li.selected")[0];if(g.target){this.li_clicked(g)}}}}}))();app.ContextMenu=Backbone.View.extend({template:_.template("<div class='context_menu' oncontextmenu='return false;'><ul><% _.each(items,function(item){ %><li data-val='<%=item.key%>'><%=item.value%></li><% }) %></ul></div>"),items:[{key:"noitem",value:"No Items"}],width:100,initialize:function(a){this.view=this;_.extend(this,_.pick(a,["items","width","view","callback"]))},show_menu:function(){},show:function(e,a,d){var b=this,c=$("#global_dropdown_container");c.html(this.template({items:this.items})).off("click").on("click",function(f){app.opened_dropdown.hide();app.opened_dropdown=null;if(b.callback){b.callback.call(b.view,e,$(f.target).data("val"),d)}else{b.view.trigger("context_item_click",e,$(f.target).data("val"),d)}}).css({top:a.top,left:a.left,width:this.width}).show();app.opened_dropdown=c}});app.Notifications=Backbone.View.extend({template:_.template("<div class='notif_item notif_type_<%=type%>'><h5 class='notif_head'><%=head%></h5><p class='notif_text'><%=text%></p></div>"),timeout:10000,types:{error:{color:"#fff",background:"#f00"},success:{color:"#fff",background:"#0f0"},info:{color:"#fff",background:"#0f0"}},items:[],add:function(b,f,d,e){var a=this,c;if(typeof b=="string"){b={head:b,text:f,type:d}}else{b=_.extend({head:"Head",text:"Text",type:"Error"},b)}if(this.items.indexOf(b.text)!=-1){return}this.items.push(b.text);c=$(this.template(b));setTimeout(function(){c.remove();a.items.splice(b.text)},e||4000);this.$el.append(c)}});app.notifications=new app.Notifications({el:$("#global_notif_container")});app.Table=Backbone.View.extend({events:{"click .btn":"button_clicked"},initialize:function(a){_.extend(this,_.pick(a,["data","id"]));if(!("el" in a)){this.$el.addClass("component dl_table");this.$el.addClass(this.id);if(a.appendTo){a.appendTo.append(this.$el)}}},button_clicked:function(a){this.trigger("button_clicked",a)},render:function(a){this.$el.html(this.template(a||this.data))}});app.Table.prototype.template=_.template($("#table_template").html());app.FileGridView=Backbone.View.extend({events:{"click .add_btn":"add_clicked","click ._delete_btn":"delete_clicked","click ._download_btn":"download_clicked","click ._setdef_btn":"set_default_clicked","click .gv_item_cnt":"item_cnt_clicked","change .gv_file_ip":"upload_field_chng"},initialize:function(a){_.extend(this,_.pick(a,["id","item_type","appendTo","doc_type","doc_id","head","class_name"]));if(!a||!("el" in a)){var b=this.outer_template({id:this.id,class_name:this.class_name||"",head:this.head});this.setElement($(b));if(this.appendTo){$(this.appendTo).append(this.$el)}}this.toogle_btns(false)},toogle_btns:function(a){this.$el.find(".gv_btn_cnt > button")[a?"removeClass":"addClass"]("disabled")},item_cnt_clicked:function(b){var a;a=$(b.target);this.$el.find(".gv_item").removeClass("selected");if(a.closest(".gv_item:not(.add_btn)").length){a.closest(".gv_item").addClass("selected");this.toogle_btns(true)}else{this.toogle_btns(false)}},setMode:function(b){var a;a=this;a.$el.find(".gv_working_div").remove();if(b=="loading"){a.$el.prepend('<div class="gv_working_div">Loading...</div>')}},set_default_clicked:function(c){var b,d,a;b=this;d=b.$el.find(".gv_item.selected").eq(0);if(d.length&&d.data("id")){a=new app.models.Attachment;a.set_default(d.data("id"),{success:function(f,e){app.notifications.add("Success","Default Image changed","success");b.toogle_btns(false)}})}},load_data:function(){var a,b;b=this;a=new app.models.Attachment;a.doc_type=b.doc_type;a.doc_id=b.doc_id;b.setMode("loading");a.fetch({success:function(e,d){var f,c,g;b.setMode("idle");for(f=0,c=d.items.length;f<c;f++){g=d.items[f];b._add_item(g.file_name,g.id,g.url)}}})},add_clicked:function(){var b,a;a=this;b=a.$el.find(".gv_item_cnt > .gv_item");if(b.length>1&&!b.last().prev().data("is_loaded")){app.notifications.add("Error","Last item is loaded with file, cannot add more","error");return}else{a.$el.find(".gv_file_ip")[0].click()}},upload_field_chng:function(b){var a;a=this;a.add_item({item_type:"img"})},upload_clicked:function(b,c){var a;a=new app.models.Attachment;a.doc_type=this.doc_type;a.doc_id=this.doc_id;a.post([this.file_ip],{success:function(e,d){b.find("img").data({file_name:d.file_name,id:d.id}).attr("src",d.url)},error:function(){}})},add_item:function(d){var b,c;b=this;el=$(b.item_template(d));if(d.src){el.data("is_loaded",true)}b.$el.find(".gv_item_cnt > .add_btn").before(el);var a=new app.models.Attachment;a.doc_id=b.doc_id;a.doc_type=b.doc_type;a.is_bind=b.is_bind;a.is_default=b.$el.find(".gv_item_cnt > .gv_item:not(.add_btn)").length<=1;c=b.$el.find(".gv_file_ip")[0];a.post([c.files[0]],{success:function(f,e){el.data({file_name:c.files[0].name,id:e.id}).find("img").attr("src",e.url)}})},_add_item:function(d,c,b){var a=this;el=$(a.item_template({item_type:"img",src:b}));if(b){el.data("is_loaded",true)}a.$el.find(".gv_item_cnt > .add_btn").before(el);el.data({file_name:d,id:c})},delete_clicked:function(c){var b,d,a;b=this;d=b.$el.find(".gv_item.selected").eq(0);if(d.length){if(d.data("id")){b.remove_item(d)}else{d.remove()}}},remove_item:function(b){var a;a=this;m=new app.models.Attachment;m.destroy(b.data("id"),{success:function(d,c){app.notifications.add("Success","Image delete successfully","success");b.remove();a.toogle_btns(false)}})},release:function(){this.$el.find(".gv_item_cnt > .gv_item:not(.add_btn)").remove()}});app.FileGridView.prototype.outer_template=_.template($("#gridview_template").html());app.FileGridView.prototype.item_template=_.template($("#gridview_item_template").html());app.DS=Backbone.View.extend({events:{"dblclick .tl_li":"row_clicked","click .tl_li":"row_selected","click .table_head_ul > li":"theadli_clicked","click .ds_filter_btn":"filter_btn_clicked","change .chkbx_ip":"checkbox_checked","click .ds_pagul li":"pagination_clicked","contextmenu .tl_li":"oncontextmenu","mouseover .table_list_ul li":"onmouseover","mousedown .tl_li":"onmousedown"},handle_pagination:false,initialize:function(a){this.rows=[];this.navigation={};this.default_params={};this.prefix_map={"{currency}":app.appdata.currency_symbol};_.extend(this,_.pick(a,["ds_id","flex_schema","schema","head_group","enable_sorting","sort_disabled_to","sort_enabled_to","default_params","collection","rows","handle_pagination","idAttr","appendTo","head","class_name"]));if(!a||!("el" in a)){var b=this.outer_template({id:this.ds_id,class_name:this.class_name||"",head:this.head,has_pagination:a.has_pagination,has_filter:a.has_filter});this.setElement($(b));if(this.appendTo){$(this.appendTo).append(this.$el)}}if(this.enable_sorting){this.$el.addClass("_en_sorting")}},onmouseover:function(j){var h=$(j.target),d,c,b=this,f,a,g;if(h.prop("tagName")=="SPAN"){d=h;h=h.parent()}else{d=h.find(">span")}a=d.width();if(a>h.width()){f=d[0].getBoundingClientRect();g=b.el.getBoundingClientRect();if(f.left+(a>400?400:a)+5>g.right){f={top:f.top,left:f.left};f.left=g.right-(a>400?400:a)-40}app.show_tooltip(d.text(),$(window).scrollTop()+f.top,f.left)}else{app.hide_tooltip()}app.opened_tooltip=c;app.opened_tooltip_cnt=this.$el},generate_widths:function(){var h,f,k,m,n,j,g,b,a,l,e,c,e,d,o;h=this.flex_schema;j=this.$el.width();if(this.$el.hasClass("ds_scrollable")){j-=15}l=[];c=[];g=0;b=0;a=0;n=false;for(f in h.show_items){k=h.show_items[f];m=h.fields[k];if(!m){console.error("Invalid Key:",k)}if(m.width){if(m.width.indexOf("px")!=-1){e=Number(m.width.replace("px",""));g+=e;l.push([e,"px"])}else{if(m.width.indexOf("%")!=-1){e=Number(m.width.replace("%",""));b+=e;l.push([e,"%"])}else{l.push([0,"a"]);n=true}}}else{l.push([0,"a"]);n=true}}d=0;o=0;if(n){e=wacky_round((j-g)*b/100,0)}else{e=wacky_round(j-g,0)}a=wacky_round(j-g-e,0);for(f in l){m=l[f];if(m[1]=="px"){c.push(m[0])}else{if(m[1]=="%"){c.push(d+m[0]<b?wacky_round(e*m[0]/b,0):wacky_round(e-o,0));d+=m[0];o+=c[c.length-1]}else{c.push(a)}}}return c},_head_grp_width:function(d,c){var b=0,a;if(d.cspan){for(a=0;a<d.cspan;a++){b+=c.widths[c.i+a]}c.i+=a}else{b=c.widths[c.i];c.i+=1}return b},generate_schema:function(){var f,e,g,d,h,j,b,a,c;f=this.flex_schema;e={};b=this.generate_widths();for(d in f.show_items){h=f.show_items[d];j=f.fields[h];if(!j){console.error("Invalid Key: ",h)}e[j.key?j.key:h]=_.extend({style:"width:"+b[d]+"px;"+(j.align?"text-align:"+j.align+";":""),index:d},_.pick(j,["head_label","head_class","type","prefix","suffix","wrapSPAN","hide_zero"]))}if(f.head_group){g={};c={widths:b,i:0};for(h in f.head_group){j=f.head_group[h];a=this._head_grp_width(j,c);g[h]={head_label:j.head_label,style:"width:"+a+"px;"+(j.align?"text-align:"+j.align+";":"")}}}return{widths:b,schema:e,head_group:g}},onresize:function(){var g,d,c,e,f,b,a;c=0;a=this;b=a.flex_schema;if(!b){return}g=a.generate_widths();for(d in a.schema){f=a.schema[d];f.style=f.style.replace(/width:[\d \.]+px/,"width:"+g[c]+"px");c++}if(b.head_group){params={widths:g,i:0};for(d in b.head_group){f=this.head_group[d];f.style=f.style.replace(/width:[\d \.]+px/,"width:"+a._head_grp_width(b.head_group[d],params)+"px")}}e=a.$el.find("style").parent();a.$el.find("style").remove();a.$el.find(".ds_container").css("width",_.sum(g)+"px");e.append($(a.style_template({schema:a.schema,head_group:a.head_group,ds_id:a.ds_id})))},reset:function(){this.rows=[];this.$el.addClass("empty");this.$el.find(".ds_container").html("")},render:function(){var h,a,l,j,f,d;this.rows.length==0?this.$el.addClass("empty"):this.$el.removeClass("empty");this.$el.removeClass("loading error");if(!this.idAttr){this.idAttr="id"}if(this.flex_schema){d=this.generate_schema();this.schema=d.schema;this.head_group=d.head_group}var n={ds_id:this.ds_id,schema:this.schema,head_group:this.head_group,prefix_map:this.prefix_map,idAttr:this.idAttr,rows:this.rows,classes:""};h=this.template(n);this.$el.find(".ds_container").html(h);if(d){this.$el.find(".ds_container").css("width",(_.sum(d.widths)+(this.$el.hasClass("ds_scrollable")?15:0))+"px")}this.$el.find(".ds_pagination").html("");if(this.sort_by_key){this.$el.find(".table_head_ul > li").removeClass("_sorted_asc _sorted_dsc");f=Object.keys(this.schema).indexOf(this.sort_by_key.replace(/^-/,""));this.$el.find(".table_head_ul > li").eq(f).addClass(this.sort_by_key.charAt(0)!="-"?"_sorted_asc":"_sorted_dsc")}f=this.$el.find(".table_list");if(f[0].scrollHeight&&f[0].scrollHeight>f.outerHeight()){d=this.$el.find(".table_head_ul");d.css({paddingRight:wacky_round(d.outerWidth()-f[0].scrollWidth,2)+"px"})}if(!_.isEmpty(this.navigation)&&this.navigation.items_count>0){a=[];l=this.navigation.page_count;j=this.navigation.current_page;if(l<=10){for(i=1;i<=l;i++){var e={type:"page",text:i};if(i==j){e.type="activepage"}a.push(e)}}else{var c,b,m,k,g=0;c=j-1;b=l-j;if(c>4&&b>4){m=k=4}else{if(c<=4){m=c;k=9-c-1}else{if(b<=4){k=b;m=9-b-1}}}if(c>4){a.push({type:"page",text:1});a.push({type:"dot",text:"..."});g=2}for(i=m-g;i>0;i--){a.push({type:"page",text:j-i})}a.push({type:"activepage",text:j});g=b>4?2:0;for(i=1;i<=k-g;i++){a.push({type:"page",text:j+i})}if(b>4){a.push({type:"dot",text:"..."});a.push({type:"page",text:l})}}this.$el.find(".ds_pagination").html(this.pagn_templt({nav:this.navigation,pages:a}))}this.trigger("rendered","",this)},theadli_clicked:function(b){var a,c;if(this.enable_sorting){a=$(b.target).closest("li");c=Object.keys(this.schema)[a.index()];if(this.sort_enabled_to&&this.sort_enabled_to.indexOf(c)==-1){return}if(this.sort_disabled_to&&this.sort_disabled_to.indexOf(c)!=-1){return}if(this.sort_by_key){if(this.sort_by_key.replace("^-","")==c){this.sort_by(this.sort_by_key.charAt(0)=="-"?c:"-"+c)}else{this.sort_by(c)}}else{this.sort_by(c)}}},gen_inputs:function(d,b){var c,f,e,a,h,g;g={};for(c in d.filter_enable){e=d.filter_enable[c];f=d.fields[e];a=f.f_key||e;h={class_name:b.class_name||"_type1 _md _comp_inline _mgrt_2em _w100pc _mgbt_05em",index:c,label:f.head_label};if(f.fltr_ip_class){h.class_name+=f.fltr_ip_class}if(f.choices){_.extend(h,{type:"selectbox",options:f.choices,default_option:""})}else{if(f.url){_.extend(h,{type:"combobox",label_sel:"name",value_sel:"name",embedd_list_el:false},_.pick(f,["url","embedd_list_el","list_selector","label_sel","value_sel"]))}else{_.extend(h,{type:"inputbox"})}}g[a]=h}ips_fields={};if(b&&b.inc_ips){for(c in d.ips_filter_enable){e=d.ips_filter_enable[c];f=d.fields[e];ips_fields[e]=f.head_label}}return[g,ips_fields]},filter_btn_clicked:function(){var b,a;a=this;form_fields={};flex_schema=a.flex_schema;if(flex_schema&&flex_schema.filter_enable){b=a.gen_inputs(flex_schema,{inc_ips:true})}else{return}app.DS.filter_popup.show({ds:a,method:"filter",cur_filtr:a.c_filter_org||{},form_fields:b[0],filter_fields:b[1]})},sort_by:function(b){var a;if(this.options&&this.options.params){a=this.options}else{a={params:{}}}a.params.sort_by=b;this.load(a)},load:function(c,b){var a=this,e,d,c,f;if(!b){b=this.model}this.options=c=c||{};if(c.presv_flt){c.params=_.extend({},c.presv_flt==2?_.pick(this.current_filter,["per_page","page"]):this.current_filter,c.params)}if(c.params||this.default_params){d=_.extend({},this.default_params,c.params);if(d.sort_by){this.sort_by_key=d.sort_by}e=c.use_post?JSON.stringify(d):$.param(d)}else{e=null}if(this.$el.hasClass("loading")){console.error("Double Triggering detected");console.trace();return}this.$el.addClass("loading");f=setTimeout(function(){if(a.xhr){a.xhr.abort();a.xhr=null}a.$el.removeClass("loading").addClass("error");a.trigger("load_error",null,this,null)},20000);fetch_options={data:e};if(c.use_post){fetch_options.type="POST";fetch_options.attach_csrf=true;fetch_options.contentType="application/json"}if(a.xhr){a.xhr.abort();a.xhr=null}a.xhr=b.fetch(_.extend(fetch_options,{success:function(h,g){a.xhr=null;if(g.cols){g.items=_.map(g.items,function(j){return _.object(g.cols,j)})}clearTimeout(f);if(a.before_render){a.before_render.call(c.invoker||a,h,g)}a.trigger("before_render",g,a,null);h.set("items",g.items);a.sync_model(h);a.current_filter=c.params;a.c_filter_org=c.params_org;a.render();if(c.success){c.success.call(c.invoker||a,h,g)}a.trigger("loaded",g,this,null)},error:function(g,j){var h;clearTimeout(f);a.xhr=null;a.$el.removeClass("loading");if(c.error){h=c.error.call(c.invoker||a,g,j)}a.render();if(h!=true){a.$el.addClass("error")}a.trigger("load_error",j,this,null)}}))},release:function(){this.rows=[];this.navigation=null;this.$el.find(".ds_container").html("");this.$el.find(".ds_pagination").html("")},onmousedown:function(a){if(a.detail>1&&!_.in_list($(a.target).prop("tagName"),["INPUT","BUTTON"])){a.preventDefault()}},row_clicked:function(b){var a=$(b.target).closest(".tl_li");if(!_.in_list($(b.target).prop("tagName"),["INPUT","BUTTON"])){this.trigger("li_clicked",a.data("id"),this,b)}},row_selected:function(f){var a,d,b;var c=$(f.target).closest(".tl_li");if(!(f.ctrlKey||f.shiftKey)){this.$el.find(".ds_container>div>.table_list>li").removeClass("selected")}if(f.shiftKey){sel_items=this.$el.find(".ds_container>div>.table_list>li.selected");if(sel_items.length){if(c.index()<sel_items.eq(0).index()){a=c.index();d=sel_items.eq(0).index()}else{a=sel_items.eq(0).index();d=c.index()}for(b=a;b<=d;b++){this.$el.find(".ds_container>div>.table_list>li").eq(b).addClass("selected")}}}else{c.addClass("selected")}this.trigger("li_selected",c.data("id"),this,f)},oncontextmenu:function(b){if(b.which==3){var a=$(b.target).closest(".tl_li");this.trigger("context_menu",a.data("id"),this,b);return false}},pagination_clicked:function(c){var b=$(c.target),a;if(!b.hasClass("active")&&!b.hasClass("dots")){if(this.handle_pagination==true){a=this.options||{};a.params=a.params||{};a.params.page=b.text();this.load(a)}this.trigger("pagin_clicked",b.text(),this,c)}},get_row:function(c){var a,b;for(a in this.rows){b=this.rows[a];if(b[this.idAttr]==c){return b}}return null},get_row_el:function(d){var b,a,c;for(b=0,a=this.rows.length;b<a;b++){c=this.rows[b];if(c[this.idAttr]==d){return this.$el.find(".tl_li").eq(b)}}return null},get_selected_rows:function(){var a,f={},d,b,c,e;a=this.$el.find(".table_list");d=a.find(">.tl_li.selected");for(b=0;b<d.length;b++){f[b]=this.rows[$(d[b]).index()]}return f},get_checked_rows:function(b){var a,g={},e,c,d,f;a=this.$el.find(".table_list");e=a.children();for(c=0;c<e.length;c++){d=$(e[c]);f=d.find("input.chkbx_ip");if(f.is(":checked")){g[c]=b?this.rows[c][this.idAttr]:this.rows[c]}}return g},set_checked_rows:function(d){d=d||[];var a,g=[],e,b,c,f;a=this.$el.find(".table_list");e=a.children();for(b=0;b<e.length;b++){c=$(e[b]);f=c.find("input");if(d.indexOf(c.data("id"))!=-1){f.prop("checked",true)}}},check_uncheck_all:function(g){var a,f=[],d,b,c,e;a=this.$el.find(".table_list");d=a.children();for(b=0;b<d.length;b++){c=$(d[b]);e=c.find("input");e.prop("checked",g)}},checkbox_checked:function(a){this.trigger("checkbox_cliked",a.target.checked,this,a)},sync:function(b,c){var a=this;this.rows=[];if(!b){b=this.collection}_.each(b.models,function(e){var d=_.clone(e.attributes);if(c){c(d)}a.rows.push(d)})},gl_ev_handler:function(a,b){if(this.has_menu){return app.ContextMenu_ext.gl_ev_handler(a,b)}switch(a){case"keydown":if(b.keyCode==16){this.$el.css("user-select","none");break}else{return this.key_press_handler(b)}case"keyup":if(b.keyCode==16){this.$el.css("user-select","")}break}},context_item_click:function(a,c,b){this.trigger("context_item_click",a,this,null,{value:c,data:b})},show_menu:function(f,b,d){var a,c;if(d.pageX){a={left:d.pageX,top:d.pageY}}else{c=$(d.target);a={left:c.position().left+(c.width()/2),top:c.offset().top}}app.ContextMenu_ext.show(this,b,f,{position:a,callback:this.context_item_click});this.has_menu=true;app.opened_menu={context:this,onclose:function(){this.has_menu=false}}},key_press_handler:function(j){var n,c,d,h,m,k,b,l;l=false;n=this.$el.find(".ds_container>div>.table_list>li");switch(j.keyCode){case 38:case 40:c=n.filter(".selected");if(c.length){if(j.keyCode==40){d=c.is(":last-child")?(l?n.first():null):c.next()}else{d=c.is(":first-child")?(l?n.last():null):c.prev()}if(!d){return}c.removeClass("selected")}else{d=n.first()}d.addClass("selected");j.preventDefault();this.trigger("li_selected",d.data("id"),this,j);var a,g,f;a=$(getScrollParent(d[0]));if(a.length&&a.prop("tagName")!="BODY"){b=d.offset().top;f=a.offset();if(b<f.top||b+d.outerHeight()>f.top+a.outerHeight()){g=a.children().first().offset().top;h=j.keyCode==38?b-g:b+d.outerHeight()-g-a.outerHeight();a.scrollTop(h)}}else{m=window.innerHeight;k=window.pageYOffset;b=d[0].getBoundingClientRect().top;f=this.$el.find(".ds_head_cnt").outerHeight();if(b<(50+f)||b+d.outerHeight()>m){h=j.keyCode==38?b+k-50-f:b+k+d.outerHeight()+20-m;window.scrollTo({top:h})}}break;case 13:c=n.filter(".selected");if(c.length){this.trigger("li_clicked",c.data("id"),this,j)}break}},sync_model:function(b,c){var a=this;this.rows=[];if(!b){b=this.model}_.each(b.get("items"),function(d){if(c){c(d)}a.rows.push(d)});this.navigation=_.pick(b.attributes,["current_page","items_count","page_count","per_page"])},insertRow:function(){},removeRow:function(){}});app.DS.prototype.template=_.template($("#ds_template").html());app.DS.prototype.style_template=_.template($("#ds_style_template").html());app.DS.prototype.outer_template=_.template($("#ds_outer_template").html());app.DS.prototype.pagn_templt=_.template($("#ds_pagin_template").html());app.DS.filter_popup_class=app.Popup.extend({id:"ds_filter_popup",class_name:"_mw1000x",btn_map:{filter:["Filter","Filtering"]},head:"Filter",events:{submit:"submit_form","click .op_btn":"submit_form"},show_save_n_next:false,render:function(f){var d,g,a,e,c;d=this;e=d.options;if(!f){d.$el.find(".popup_body").addClass("clearfix");d.form=new app.Form({appendTo:d.$el.find(".popup_body"),order_items:true,class_name:"float_left _w35pc",default_attr:{class_name:"_type1 _md "}});var b=app.IPS.extend({class_name:"_mgbt_1em float_right _w60pc filter_ips",schema:{field_name:{head_label:"Field",width:40,ip_options:{type:"selectbox",default_option:"",options:null,label:"Field",id:"_type3"}},op:{head_label:"Op",width:25,ip_options:{type:"selectbox",default_option:"",options:[{eq:"Eqials"},{gte:">= (From)"},{lte:"<= (To)"},{neq:"Exclude"}],label:"Value",id:"_type3"}},value:{head_label:"Value",width:35,ip_options:{type:"inputbox",label:"Value",id:"_type2"}}},validation:{field_name:{required:true},op:{required:true},value:{required:true}},after_init:function(h){d.listenTo(d,"all",d.ips_event_handler);d.vald_form=new app.Form({el:d.$el,validation:d.validation});d.parent=h.parent},ips_event_handler:function(o,q,h,m,j){var n,k,l,p;n=q;q=d.rows[q];switch(o){case"text_changed":if(m.keyCode==8){d.backspace_pressed(q,n,h);d.update_total()}break;case"enterkey_press":if(d.focusColumn(q,h,"next",true,{select:true})==false){d.validate_row(q,true,{dr_cr:"Dr"})}break}}});b.merge(app.IPS_ext,true);d.ip_sheet=new b({ips_id:"ds_filter_sheet",ip_defaults:{class_name:"_sm2 _type2 _nouline _pdlt0"},appendTo:d.$el.find(".popup_body")});d.listenTo(d.ip_sheet,"all",d.ip_sheet_handler)}g=d.form;a=d.ip_sheet;g.release();if(e.form_fields){g.renderInputs(e.form_fields)}a.release();if(e.filter_fields){a.schema.field_name.ip_options.options=e.filter_fields;a.$el.show();a.render();a.insertRow({})}else{a.$el.hide()}d.setMode("idle");g.set_values(e.cur_filtr);for(comp in g.components){c=g.components[comp];if(c.type=="combobox"&&c.label_sel!=c.value_sel){c.emul_itemselect()}}},submit_form:function(h){var b,a,g,f,d,c;a=this;b=a.form.get_values(true);values1=a.form.get_values(true,null,{t2:true});g=a.ip_sheet.get_value_list();for(d=0;d<g.length;d++){f=g[d];if(f.field_name!=""){c=f.field_name+(f.op!=""?"."+f.op:"");b[c]=values1[c]=f.value}}a.options.ds.load({params:b,params_org:values1});a.close()}});app.DS.search_popup_class=app.Popup.extend({id:"ds_search_popup",class_name:"_mw1200x",btn_map:{set:["OK","OK"]},head:"Search",events:{"click .op_btn":"submit_form"},manual_focus:true,show_save_n_next:false,afterShow:function(){var a,c,b;b=[this.ds.$el.find(".ds_container"),this.ds.$el];for(c in b){a=b[c];a.css({height:$(window).height()-(a.closest(".popup").outerHeight()-a.outerHeight())-20})}this.center()},render:function(c){var b,a;a=this;if(!c){a.form=new app.Form({appendTo:a.$el.find(".popup_body"),order_items:true,default_attr:{class_name:""}});a.listenTo(a.form,"all",a.form_ev_handler);a.ds=new app.DS({class_name:"hoverable ds_with_head ds_scrollable",ds_id:"ds_vchr_list",appendTo:this.$el.find(".popup_body")});a.listenTo(a.ds,"all",a.ds_ev_handler)}a.form.release();a.ds.reset();b=a.options.flex_schema;schemas=app.DS.prototype.gen_inputs(b,{inc_ips:false,class_name:"_type1 _sm2 _comp_inline _mgbt_1em _w20em _mgrt_1em"});_.extend(a.ds,{flex_schema:b,model:new (gen_model(this.options.root_url))});a.form.renderInputs(_.extend({submit_btn:{type:"button",class_name:"_type1 _sm2 _comp_block _w7em _theme1",index:999999,label:"Search",attrs:{type:"submit"}}},schemas[0]));this.setMode("idle")},form_ev_handler:function(c,b,d){var a;a=this;if(c=="form_submit"){a.ds.load({params:_.extend(_.omit(a.form.get_values(true),["submit_btn"]),a.options.srch_def_args)})}},ds_ev_handler:function(a,d,b,c){if(a=="li_clicked"){this.submit_form()}},submit_form:function(g){var b,a,d,c,f;b=this.ds.get_selected_rows();if(!_.isEmpty(b)){b=b[_.keys(b)];a=this.options.comp;f=[b];if(a.value_sel!=a.label_sel){a.set_value([b[a.value_sel],b[a.label_sel]],f)}else{a.set_value(b[a.label_sel],f)}}this.close()},after_close:function(){var a;a=this.options.comp;a.focus()}});app.DS.filter_popup=new app.DS.filter_popup_class();app.DS.search_popup=new app.DS.search_popup_class();app.Router=Backbone.Router.extend({routes:{"":"handleDefaultRoute","view/:view_name(/:optional)(/)(?:optional2)":"handleViewRoute"},url_regex:/[\?|&]?([a-zA-Z0-9_]+)=([%\/a-zA-Z0-9+\s-_,]+)/g,handleDefaultRoute:function(){app.eventBus.trigger("show:dashboard")},handleViewRoute:function(c,d,g,b,f){var a,e=undefined;if(g){e={};while((a=this.url_regex.exec(g))!==null){if(a.index===this.url_regex.lastIndex){this.url_regex.lastIndex++}e[a[1]]=a[2]}}app.eventBus.trigger("show:"+c,d,e,f)}});app.router=new app.Router;(function(){var a=_.template($("#generic_page_template").html());app.popup_views.Prompt=app.Popup.extend({events:{"click .prompt_btn":"btn_clicked"},id:"prompt",head:"",beforeInit:function(){this.template_1=_.template($("#prompt_template").html());return true},render:function(c){var b;b=this;b.trigger_data=_.extend({head:"Head",text:"text",prompt_type:"yes_no",type:"normal"},b.options);b.setElement($(b.template_1(b.trigger_data)))},btn_clicked:function(c){c.preventDefault();var b=this.trigger_data;this.close();if(b.callback){b.callback.call(b.context,$(c.target).data("id"),b.data)}else{b.context.trigger("popup_event","prompt_btn:click",b.prompt_id,$(c.target).data("id"))}}});app.Prompt=new app.popup_views.Prompt();app.ListPageTemplate=Backbone.View.extend({context_menu_items:[{key:"edit",value:"Edit"},{key:"delete",value:"Delete"}],is_focusable:false,pre_init:function(){var b;b=this;if(!b.is_tab_view){app.eventBus.on("show:"+b.page_name,b.on_page_url,b)}b.pre_inited=true},init:function(c){var b=this,d;if(c&&c.create_el){d=$(a({page_id:b.page_name,head:b.heading_plural}));$(".app_page_views").append(d);b.setElement(d)}if(b.before_init){b.before_init(c)}b.children=[];if(!b.disable_ds){b.ds=new app.DS(_.extend({model:new b.model,has_pagination:true,handle_pagination:true,appendTo:b.$el},b.ds_options));b.listenTo(b.ds,"all",b.ds_handler);b.ds.render();b.children.push(b.ds)}if(!b.disable_menu){b.context_menu=new app.ContextMenu({items:b.context_menu_items,width:200});b.listenTo(b.context_menu,"context_item_click",b.context_item_click)}if(!b.pre_inited&&!b.is_tab_view){app.eventBus.on("show:"+b.page_name,b.on_page_url,b)}if(!b.no_newbtn){d=b.is_tab_view?b.$scope.$el:b.$el;b.$top_sec_el=$("<div class='top_buttons'><button class='component btn _type1 _theme1 _md new_item_btn'>"+(b.btn_heading?b.btn_heading:"New "+b.heading)+"</button></div>");d.find(".content-topsec .float-right").append(b.$top_sec_el);b.$top_sec_el.on("click",".new_item_btn",function(){b.show_popup()})}if(b.is_tab_view){b.pass_through=true}else{b.is_focusable=false}b.is_inited=true},show_popup:function(c){var b;b=this;b.popup.show(_.extend({method:"create",invoker:b,callback:b.popup_callback,data:null},b.popup_options,c))},popup_callback:function(d,c){var b=this;setTimeout(function(){b.ds.load({presv_flt:false})},100)},tab_show:function(b,c){var d=this.$el.find(".top_buttons");d.hide();app.router.navigate(app.generate_url(this.page_name,b,c.args),{trigger:false,replace:c.do_replace})},context_item_click:function(f,b,e){var d,c;c=this;if(b=="edit"){d=this.ds.get_row(f),c=this;if(this.edit_data_filter){d=_.pick(d,c.edit_data_filter)}if(c.popup_options&&c.popup_options.data){_.extend(d,c.popup_options.data)}c.popup.show(_.extend({method:"update",invoker:c,callback:c.popup_callback,id:f,data:d},_.omit(c.popup_options,["data"])))}else{if(b=="delete"){app.Prompt.show({head:"Delete this item?",text:"Do you sure you want to delete this item?",data:{id:f,extra_args:e},callback:c.delete_item,context:c})}}},delete_item:function(e,d){var c,b;if(e=="yes"){d=_.isObject(d)?d:{id:d};c=d.extra_args&&d.extra_args.model?d.extra_args.model:this.model;c=new c({id:d.id});b=this;c.destroy({success:function(g,f){app.notifications.add(f.head,f.msg,"success");b.ds.load()},error:function(g,h){var f=h.responseJSON;if(f){app.notifications.add("Error While Delete",f.errors.__all__,"error")}else{app.notifications.add("Error While Delete","Unknown error while delete","error")}}})}$.magnificPopup.instance.close()},ds_handler:function(b,f,c,d){return this._ds_handler(b,f,c,d)},_ds_handler:function(f,i,g,h,c){var d,b;b=this;if(f=="context_menu"&&!b.disable_menu){b.context_menu.show(i,{left:h.pageX,top:h.pageY},{ds:g})}else{if(f=="li_clicked"){if(b.drill_to_view){if(b.has_unclickable){d=g.get_row(i);if(d.clickable==false){return}}app.router.navigate(app.generate_url(b.drill_to_view,i,b.drill_arguments),{trigger:true})}else{if(b.popup){b.context_item_click(i,"edit")}}}}},print_data:function(){var c,f,e,b,d;b=this;e=b.ds;c=app.generate_ext_url(e.model.urlRoot,null,_.extend({op:"print_preview"},e.default_params,e.options.params));window.open(c,"_blank").addEventListener("load",function(){this.focus();this.print()},false)},export_data:function(d){var c,b;b=this;c=b.ds;$("#myiframwe").attr("src",app.generate_ext_url(c.model.urlRoot,(d||null),_.extend({op:"export_to_excel"},c.default_params,c.options.params)))},on_page_url:function(b,d,e){var c;c=this;if(c.pre_show){c.pre_show(b,d)}app.pages.show_page(c);if(c.header_btns){app.TopButtons.set(c.header_btns)}if(c.ds&&!c.no_ds_autoload){c.ds.load({params:d,presv_flt:!e})}if(c.onshow){c.onshow(b,d,e)}}});app.PageTemplate=Backbone.View.extend({pre_init:function(){var b;b=this;app.eventBus.on("show:"+b.page_name,b.on_page_url,b);b.pre_inited=true},init:function(c){var b;b=this;if(c&&c.create_el){tmp=$(a({page_id:b.page_name,head:b.heading_plural}));$(".app_page_views").append(tmp);b.setElement(tmp)}if(b.is_tab_view){b.pass_through=true}else{b.is_focusable=false}b.is_inited=true;if(!b.pre_inited){app.eventBus.on("show:"+b.page_name,b.on_page_url,b)}},print_data:function(){var c,f,e,b,d;b=this;if(b.tabs){d=b.tabs.tabs[b.tabs.current_tab];e=d.ds}else{e=b.ds}c=app.generate_ext_url(e.model.urlRoot,null,_.extend({op:"print_preview"},e.default_params,e.options.params));window.open(c,"_blank").addEventListener("load",function(){b.focus();b.print()},false)},export_data:function(){var c,b;b=this;if(b.tabs){tab=b.tabs.tabs[b.tabs.current_tab];c=tab.ds}else{c=b.ds}$("#myiframwe").attr("src",app.generate_ext_url(c.model.urlRoot,null,_.extend({op:"export_to_excel"},c.default_params,c.options.params)))},on_page_url:function(b,d,e){var c;c=this;if(c.on_preshow){c.on_preshow(b,d)}app.pages.show_page(c);if(c.header_btns){app.TopButtons.set(c.header_btns)}if(c.onshow){c.onshow(b,d,e)}}})})();